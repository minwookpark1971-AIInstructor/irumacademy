<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>관리자 페이지 | Irum Academy</title>
    
    <!-- CSS -->
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/animations.css">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    
    <style>
        .admin-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }
        .login-container {
            max-width: 400px;
            margin: 10rem auto;
            padding: 2rem;
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border);
        }
        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        .stat-label {
            color: var(--text-muted);
            font-size: 0.875rem;
        }
        .applications-table {
            background: white;
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .table-header {
            background: var(--primary);
            color: white;
            padding: 1rem;
            font-weight: 600;
        }
        .table-content {
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        th {
            background: #f9fafb;
            font-weight: 600;
            color: var(--text);
            font-size: 0.875rem;
            text-transform: uppercase;
        }
        tr:hover {
            background: #f9fafb;
        }
        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }
        .status-approved {
            background: #d1fae5;
            color: #065f46;
        }
        .status-rejected {
            background: #fee2e2;
            color: #991b1b;
        }
        .application-detail {
            display: none;
            margin-top: 1rem;
            padding: 1rem;
            background: #f9fafb;
            border-radius: 0.5rem;
        }
        .application-detail.active {
            display: block;
        }
        .detail-row {
            display: grid;
            grid-template-columns: 150px 1fr;
            gap: 1rem;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border);
        }
        .detail-label {
            font-weight: 600;
            color: var(--text-muted);
        }
        .filter-bar {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        .filter-select {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border);
            border-radius: 0.375rem;
            background: white;
        }
        .no-applications {
            text-align: center;
            padding: 3rem;
            color: var(--text-muted);
        }
        .admin-section {
            display: block;
        }
        .admin-tab {
            transition: all 0.3s ease;
        }
        .admin-tab:hover {
            color: var(--primary) !important;
        }
    </style>
</head>
<body>
    <!-- Admin Header -->
    <header class="main-header" style="position: fixed; top: 0; left: 0; right: 0; z-index: 1000; background: white; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);">
        <div class="container">
            <div class="header-content" style="display: flex; align-items: center; justify-content: space-between; padding: 1rem 0;">
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <a href="../index.html" class="logo">
                        <img src="../images/logo/이룸아카데미_logo.png" alt="Irum Academy" class="logo-image" style="height: 60px; width: auto; display: block;" data-original-src="../images/logo/이룸아카데미_logo.png" onerror="this.onerror=null; if(!this.dataset.retried) { this.dataset.retried='true'; this.src=encodeURI(this.dataset.originalSrc); } else { this.style.display='none'; }">
                    </a>
                    <h1 style="margin: 0; font-size: 1.25rem; font-weight: 600; color: var(--text);">irumcompany 관리자</h1>
                </div>
            </div>
        </div>
    </header>

    <!-- Login Screen -->
    <div id="login-screen" class="login-container" style="display: block;">
        <h2 style="text-align: center; margin-bottom: 2rem;">관리자 로그인</h2>
        <form id="login-form">
            <div class="form-group">
                <label for="admin-username" class="form-label">아이디</label>
                <input type="text" id="admin-username" class="form-input" required>
            </div>
            <div class="form-group">
                <label for="admin-password" class="form-label">비밀번호</label>
                <input type="password" id="admin-password" class="form-input" required>
            </div>
            <button type="submit" class="btn btn-primary btn-lg" style="width: 100%; margin-top: 1rem;">
                로그인
            </button>
        </form>
    </div>

    <!-- Admin Dashboard -->
    <main class="main-content" id="admin-dashboard" style="display: none; background-color: #f9fafb; padding-top: 120px; padding-bottom: 3rem;">
        <div class="admin-container">
            <div class="admin-header">
                <h1 style="margin: 0;">관리자 대시보드</h1>
                <div>
                    <button id="export-applications-btn" class="btn btn-outline" style="margin-right: 0.5rem;">
                        신청 내역 엑셀 내보내기
                    </button>
                    <button id="export-users-btn" class="btn btn-outline" style="margin-right: 0.5rem;">
                        회원 목록 엑셀 내보내기
                    </button>
                    <button id="export-inquiries-btn" class="btn btn-outline" style="margin-right: 0.5rem; display: none;">
                        문의 내역 엑셀 내보내기
                    </button>
                    <button id="export-login-history-btn" class="btn btn-outline" style="margin-right: 0.5rem; display: none;">
                        로그인 이력 엑셀 내보내기
                    </button>
                    <button id="refresh-btn" class="btn btn-outline" style="margin-right: 0.5rem;">
                        새로고침
                    </button>
                    <button id="logout-btn" class="btn btn-outline">
                        로그아웃
                    </button>
                </div>
            </div>

            <!-- Tab Navigation -->
            <div style="display: flex; gap: 0.5rem; margin-bottom: 2rem; border-bottom: 2px solid var(--border);">
                <button class="admin-tab active" data-tab="applications" style="padding: 0.75rem 1.5rem; background: none; border: none; border-bottom: 2px solid var(--primary); color: var(--primary); font-weight: 600; cursor: pointer;">
                    신청 관리
                </button>
                <button class="admin-tab" data-tab="users" style="padding: 0.75rem 1.5rem; background: none; border: none; color: var(--text-muted); font-weight: 600; cursor: pointer;">
                    회원 관리
                </button>
                <button class="admin-tab" data-tab="inquiries" style="padding: 0.75rem 1.5rem; background: none; border: none; color: var(--text-muted); font-weight: 600; cursor: pointer;">
                    문의 관리
                </button>
                <button class="admin-tab" data-tab="notices" style="padding: 0.75rem 1.5rem; background: none; border: none; color: var(--text-muted); font-weight: 600; cursor: pointer;">
                    공지사항 관리
                </button>
                <button class="admin-tab" data-tab="login-history" style="padding: 0.75rem 1.5rem; background: none; border: none; color: var(--text-muted); font-weight: 600; cursor: pointer;">
                    로그인 이력
                </button>
                <button class="admin-tab" data-tab="courses" style="padding: 0.75rem 1.5rem; background: none; border: none; color: var(--text-muted); font-weight: 600; cursor: pointer;">
                    과정 관리
                </button>
                <button class="admin-tab" data-tab="schedules" style="padding: 0.75rem 1.5rem; background: none; border: none; color: var(--text-muted); font-weight: 600; cursor: pointer;">
                    온라인강의 일정관리
                </button>
                <button class="admin-tab" data-tab="instructor-program" style="padding: 0.75rem 1.5rem; background: none; border: none; color: var(--text-muted); font-weight: 600; cursor: pointer;">
                    전문강사 성장 프로그램 관리
                </button>
            </div>

            <!-- Applications Section -->
            <div id="applications-section" class="admin-section">
                <!-- Statistics -->
                <div class="admin-stats">
                    <div class="stat-card">
                        <div class="stat-number" id="total-count">0</div>
                        <div class="stat-label">전체 신청</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="pending-count">0</div>
                        <div class="stat-label">대기 중</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="approved-count">0</div>
                        <div class="stat-label">승인됨</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="rejected-count">0</div>
                        <div class="stat-label">거절됨</div>
                    </div>
                </div>

                <!-- Filter Bar -->
                <div class="filter-bar">
                    <select id="type-filter" class="filter-select">
                        <option value="">전체 유형</option>
                        <option value="student">강의신청</option>
                        <option value="consult">상담신청</option>
                    </select>
                    <input type="text" id="search-input" class="filter-select" placeholder="이름, 이메일 검색..." style="flex: 1; min-width: 200px;">
                </div>

                <!-- Applications Table -->
                <div class="applications-table">
                    <div class="table-header">신청 내역</div>
                    <div class="table-content">
                        <table id="applications-table">
                            <thead>
                                <tr>
                                    <th>신청일시</th>
                                    <th>이름</th>
                                    <th>이메일</th>
                                    <th>연락처</th>
                                    <th>과정/유형</th>
                                    <th>희망일정</th>
                                    <th>작업</th>
                                </tr>
                            </thead>
                            <tbody id="applications-tbody">
                                <tr>
                                    <td colspan="8" class="no-applications">신청 내역이 없습니다.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Users Section -->
            <div id="users-section" class="admin-section" style="display: none;">
                <!-- User Statistics -->
                <div class="admin-stats">
                    <div class="stat-card">
                        <div class="stat-number" id="total-users">0</div>
                        <div class="stat-label">전체 회원</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="active-users">0</div>
                        <div class="stat-label">활성 회원</div>
                    </div>
                </div>

                <!-- User Filter Bar -->
                <div class="filter-bar">
                    <input type="text" id="user-search-input" class="filter-select" placeholder="이메일 검색..." style="flex: 1; min-width: 200px;">
                </div>

                <!-- Users Table -->
                <div class="applications-table">
                    <div class="table-header">회원 목록</div>
                    <div class="table-content">
                        <table id="users-table">
                            <thead>
                                <tr>
                                    <th>가입일시</th>
                                    <th>이름</th>
                                    <th>이메일</th>
                                    <th>전화번호</th>
                                    <th>가입방법</th>
                                    <th>승인상태</th>
                                    <th>작업</th>
                                </tr>
                            </thead>
                            <tbody id="users-tbody">
                                <tr>
                                    <td colspan="7" class="no-applications">회원이 없습니다.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Inquiries Section -->
            <div id="inquiries-section" class="admin-section" style="display: none;">
                <!-- Inquiry Statistics -->
                <div class="admin-stats">
                    <div class="stat-card">
                        <div class="stat-number" id="total-inquiries">0</div>
                        <div class="stat-label">전체 문의</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="answered-inquiries">0</div>
                        <div class="stat-label">답변 완료</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="pending-inquiries">0</div>
                        <div class="stat-label">답변 대기</div>
                    </div>
                </div>

                <!-- Inquiry Filter Bar -->
                <div class="filter-bar">
                    <input type="text" id="inquiry-search-input" class="filter-select" placeholder="제목, 내용, 작성자 검색..." style="flex: 1; min-width: 200px;">
                </div>

                <!-- Inquiries Table -->
                <div class="applications-table">
                    <div class="table-header">문의 목록</div>
                    <div class="table-content">
                        <table id="inquiries-table">
                            <thead>
                                <tr>
                                    <th>작성일시</th>
                                    <th>제목</th>
                                    <th>작성자</th>
                                    <th>이메일</th>
                                    <th>답변 수</th>
                                    <th>작업</th>
                                </tr>
                            </thead>
                            <tbody id="inquiries-tbody">
                                <tr>
                                    <td colspan="6" class="no-applications">문의가 없습니다.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Notices Section -->
            <div id="notices-section" class="admin-section" style="display: none;">
                <!-- Notice Statistics -->
                <div class="admin-stats">
                    <div class="stat-card">
                        <div class="stat-number" id="total-notices">0</div>
                        <div class="stat-label">전체 공지사항</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="published-notices">0</div>
                        <div class="stat-label">게시 중</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="draft-notices">0</div>
                        <div class="stat-label">임시저장</div>
                    </div>
                </div>

                <!-- Notice Actions -->
                <div class="filter-bar" style="margin-bottom: 1rem;">
                    <button id="create-notice-btn" class="btn btn-primary">
                        + 공지사항 작성
                    </button>
                    <input type="text" id="notice-search-input" class="filter-select" placeholder="제목, 내용 검색..." style="flex: 1; min-width: 200px;">
                </div>

                <!-- Notices Table -->
                <div class="applications-table">
                    <div class="table-header">공지사항 목록</div>
                    <div class="table-content">
                        <table id="notices-table">
                            <thead>
                                <tr>
                                    <th>작성일시</th>
                                    <th>제목</th>
                                    <th>작성자</th>
                                    <th>조회수</th>
                                    <th>상태</th>
                                    <th>작업</th>
                                </tr>
                            </thead>
                            <tbody id="notices-tbody">
                                <tr>
                                    <td colspan="6" class="no-applications">공지사항이 없습니다.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Login History Section -->
            <div id="login-history-section" class="admin-section" style="display: none;">
                <!-- Login History Statistics -->
                <div class="admin-stats">
                    <div class="stat-card">
                        <div class="stat-number" id="total-logins">0</div>
                        <div class="stat-label">전체 로그인</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="today-logins">0</div>
                        <div class="stat-label">오늘 로그인</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="unique-users">0</div>
                        <div class="stat-label">고유 사용자</div>
                    </div>
                </div>

                <!-- Login History Filter Bar -->
                <div class="filter-bar" style="margin-bottom: 1rem;">
                    <input type="text" id="login-search-input" class="filter-select" placeholder="이메일 또는 이름 검색..." style="flex: 1; min-width: 200px;">
                    <input type="date" id="login-date-from" class="filter-select" placeholder="시작일">
                    <input type="date" id="login-date-to" class="filter-select" placeholder="종료일">
                </div>

                <!-- Selection Mode and Actions -->
                <div class="filter-bar" style="margin-bottom: 1rem; align-items: center;">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="radio" name="selection-mode" value="all" checked>
                            <span>전체선택</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="radio" name="selection-mode" value="partial">
                            <span>부분선택</span>
                        </label>
                    </div>
                    <div style="display: flex; gap: 0.5rem; margin-left: auto;">
                        <button id="select-all-logins-btn" class="btn btn-sm btn-outline" style="display: none;">전체 선택</button>
                        <button id="deselect-all-logins-btn" class="btn btn-sm btn-outline" style="display: none;">전체 해제</button>
                        <button id="delete-selected-logins-btn" class="btn btn-sm" style="background: #ef4444; color: white; border: none; display: none;">선택 삭제</button>
                        <button id="delete-period-logins-btn" class="btn btn-sm" style="background: #f59e0b; color: white; border: none;">기간 삭제</button>
                    </div>
                </div>

                <!-- Login History Table -->
                <div class="applications-table">
                    <div class="table-header">로그인 이력</div>
                    <div class="table-content">
                        <table id="login-history-table">
                            <thead>
                                <tr>
                                    <th style="width: 50px;">
                                        <input type="checkbox" id="select-all-logins-checkbox" style="display: none;">
                                    </th>
                                    <th>로그인 일시</th>
                                    <th>이름</th>
                                    <th>이메일</th>
                                    <th>IP 주소</th>
                                    <th>브라우저</th>
                                </tr>
                            </thead>
                            <tbody id="login-history-tbody">
                                <tr>
                                    <td colspan="6" class="no-applications">로그인 이력이 없습니다.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Courses Management Section -->
            <div id="courses-section" class="admin-section" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <h2>과정별 가격 관리</h2>
                    <button id="add-course-price-btn" class="btn btn-primary">+ 과정 가격 추가</button>
                </div>
                
                <!-- Course Price Filter -->
                <div style="margin-bottom: 1.5rem; display: flex; gap: 1rem; align-items: center;">
                    <label style="font-weight: 500;">표시 옵션:</label>
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="radio" name="course-price-filter" value="all" checked>
                        <span>전체 과정</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="radio" name="course-price-filter" value="priced">
                        <span>가격 설정된 과정만</span>
                    </label>
                </div>
                
                <div class="applications-table">
                    <div class="table-header">과정 가격 목록</div>
                    <div class="table-content">
                        <table id="courses-table">
                            <thead>
                                <tr>
                                    <th>과정명</th>
                                    <th>카테고리</th>
                                    <th>가격 (원)</th>
                                    <th>작업</th>
                                </tr>
                            </thead>
                            <tbody id="courses-tbody">
                                <tr>
                                    <td colspan="4" class="no-applications">과정이 없습니다.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Schedules Management Section -->
            <div id="schedules-section" class="admin-section" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <h2>온라인강의 일정관리</h2>
                    <button id="add-schedule-btn" class="btn btn-primary">일정 추가</button>
                </div>
                
                <div class="applications-table">
                    <div class="table-header">일정 목록</div>
                    <div class="table-content">
                        <table id="schedules-table">
                            <thead>
                                <tr>
                                    <th>일정</th>
                                    <th>강의코스</th>
                                    <th>상태</th>
                                    <th>작업</th>
                                </tr>
                            </thead>
                            <tbody id="schedules-tbody">
                                <tr>
                                    <td colspan="4" class="no-applications">일정이 없습니다.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Instructor Program Management Section -->
            <div id="instructor-program-section" class="admin-section" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <h2>전문강사 성장 프로그램 관리</h2>
                </div>
                
                <!-- Program Info -->
                <div class="card" style="margin-bottom: 2rem;">
                    <div class="card-header">
                        <h3 class="card-title">프로그램 정보</h3>
                    </div>
                    <div class="card-content">
                        <div class="form-group">
                            <label for="instructor-program-title" class="form-label">프로그램명 *</label>
                            <input type="text" id="instructor-program-title" class="form-input" placeholder="강사 성장 프로그램" required>
                        </div>
                        <div class="form-group">
                            <label for="instructor-program-description" class="form-label">프로그램 설명 *</label>
                            <textarea id="instructor-program-description" class="form-input" rows="4" placeholder="프로그램 설명을 입력하세요" required></textarea>
                        </div>
                        <button id="save-program-info-btn" class="btn btn-primary">프로그램 추가</button>
                    </div>
                </div>
                
                <!-- Program List -->
                <div class="card" style="margin-bottom: 2rem;">
                    <div class="card-header">
                        <h3 class="card-title">등록된 프로그램 목록</h3>
                    </div>
                    <div class="card-content">
                        <div class="applications-table">
                            <div class="table-content">
                                <table id="instructor-programs-table">
                                    <thead>
                                        <tr>
                                            <th>프로그램명</th>
                                            <th>설명</th>
                                            <th>작업</th>
                                        </tr>
                                    </thead>
                                    <tbody id="instructor-programs-tbody">
                                        <tr>
                                            <td colspan="3" class="no-applications">등록된 프로그램이 없습니다.</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Program Schedules -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <h3>프로그램 일정 관리</h3>
                    <button id="add-instructor-schedule-btn" class="btn btn-primary">일정 추가</button>
                </div>
                <div class="applications-table">
                    <div class="table-header">프로그램 일정 목록</div>
                    <div class="table-content">
                        <table id="instructor-schedules-table">
                            <thead>
                                <tr>
                                    <th>프로그램</th>
                                    <th>일정</th>
                                    <th>상태</th>
                                    <th>작업</th>
                                </tr>
                            </thead>
                            <tbody id="instructor-schedules-tbody">
                                <tr>
                                    <td colspan="4" class="no-applications">일정이 없습니다.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Consult Schedules -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 2rem; margin-bottom: 1.5rem;">
                    <h3>Zoom 상담 일정 관리</h3>
                    <button id="add-consult-schedule-btn" class="btn btn-primary">상담 일정 추가</button>
                </div>
                <div class="applications-table">
                    <div class="table-header">상담 일정 목록</div>
                    <div class="table-content">
                        <table id="consult-schedules-table">
                            <thead>
                                <tr>
                                    <th>과정</th>
                                    <th>일정</th>
                                    <th>시간</th>
                                    <th>상태</th>
                                    <th>작업</th>
                                </tr>
                            </thead>
                            <tbody id="consult-schedules-tbody">
                                <tr>
                                    <td colspan="5" class="no-applications">상담 일정이 없습니다.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Application Detail Modal -->
    <div id="detail-modal" style="display: none; position: fixed; inset: 0; background: rgba(0, 0, 0, 0.5); z-index: 1000; align-items: center; justify-content: center;">
        <div id="modal-backdrop" style="position: absolute; inset: 0; cursor: pointer;"></div>
        <div style="position: relative; z-index: 1001; background: white; border-radius: 0.5rem; padding: 2rem; max-width: 800px; max-height: 90vh; overflow-y: auto; margin: 1rem;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2 id="detail-modal-title" style="margin: 0;">신청 상세 정보</h2>
                <button id="close-modal" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; padding: 0; width: 2rem; height: 2rem; display: flex; align-items: center; justify-content: center;">&times;</button>
            </div>
            <div id="detail-content"></div>
            <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 1.5rem;">
                <button id="approve-btn" class="btn btn-primary">승인</button>
                <button id="reject-btn" class="btn" style="background: #ef4444; color: white;">거절</button>
            </div>
        </div>
    </div>

    <!-- Notice Edit Modal -->
    <div id="notice-modal" style="display: none; position: fixed; inset: 0; background: rgba(0, 0, 0, 0.5); z-index: 1000; align-items: center; justify-content: center;">
        <div id="notice-modal-backdrop" style="position: absolute; inset: 0; cursor: pointer;"></div>
        <div style="position: relative; z-index: 1001; background: white; border-radius: 0.5rem; padding: 2rem; max-width: 900px; max-height: 90vh; overflow-y: auto; margin: 1rem; width: 100%;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2 style="margin: 0;" id="notice-modal-title">공지사항 작성</h2>
                <button id="close-notice-modal" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; padding: 0; width: 2rem; height: 2rem; display: flex; align-items: center; justify-content: center;">&times;</button>
            </div>
            <form id="notice-form">
                <div class="form-group">
                    <label for="notice-title" class="form-label">제목</label>
                    <input type="text" id="notice-title" class="form-input" placeholder="공지사항 제목을 입력하세요" required>
                </div>
                <div class="form-group">
                    <label for="notice-content" class="form-label">내용</label>
                    <textarea id="notice-content" class="form-input" rows="10" placeholder="공지사항 내용을 입력하세요" required style="resize: vertical; min-height: 200px;"></textarea>
                </div>
                <div class="form-group">
                    <label for="notice-tags" class="form-label">태그 (쉼표로 구분)</label>
                    <input type="text" id="notice-tags" class="form-input" placeholder="예: 공지, 일정, 안내">
                </div>
                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="checkbox" id="notice-published">
                        <span>즉시 게시</span>
                    </label>
                </div>
                <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 1.5rem;">
                    <button type="button" id="cancel-notice-btn" class="btn btn-outline">취소</button>
                    <button type="button" id="save-notice-draft-btn" class="btn btn-outline">임시저장</button>
                    <button type="submit" id="save-notice-btn" class="btn btn-primary">저장</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Schedule Modal -->
    <div id="schedule-modal" style="display: none; position: fixed; inset: 0; background: rgba(0, 0, 0, 0.5); z-index: 1000; align-items: center; justify-content: center;">
        <div id="schedule-modal-backdrop" style="position: absolute; inset: 0; cursor: pointer;"></div>
        <div style="position: relative; z-index: 1001; background: white; border-radius: 0.5rem; padding: 2rem; max-width: 600px; max-height: 90vh; overflow-y: auto; margin: 1rem; width: 100%;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2 style="margin: 0;" id="schedule-modal-title">일정 추가</h2>
                <button id="close-schedule-modal" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; padding: 0; width: 2rem; height: 2rem; display: flex; align-items: center; justify-content: center;">&times;</button>
            </div>
            <form id="schedule-form">
                <div class="form-group">
                    <label for="schedule-date" class="form-label">일정 *</label>
                    <input type="date" id="schedule-date" class="form-input" required>
                </div>
                <div class="form-group">
                    <label for="schedule-course" class="form-label">강의코스 *</label>
                    <select id="schedule-course" class="form-input" required>
                        <option value="">강의코스 선택</option>
                    </select>
                </div>
                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="checkbox" id="schedule-active">
                        <span>활성화</span>
                    </label>
                </div>
                <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 1.5rem;">
                    <button type="button" id="cancel-schedule-btn" class="btn btn-outline">취소</button>
                    <button type="submit" id="save-schedule-btn" class="btn btn-primary">저장</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Instructor Schedule Modal -->
    <div id="instructor-schedule-modal" style="display: none; position: fixed; inset: 0; background: rgba(0, 0, 0, 0.5); z-index: 1000; align-items: center; justify-content: center;">
        <div id="instructor-schedule-modal-backdrop" style="position: absolute; inset: 0; cursor: pointer;"></div>
        <div style="position: relative; z-index: 1001; background: white; border-radius: 0.5rem; padding: 2rem; max-width: 700px; max-height: 90vh; overflow-y: auto; margin: 1rem; width: 100%;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2 style="margin: 0;" id="instructor-schedule-modal-title">프로그램 일정 추가</h2>
                <button id="close-instructor-schedule-modal" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; padding: 0; width: 2rem; height: 2rem; display: flex; align-items: center; justify-content: center;">&times;</button>
            </div>
            <form id="instructor-schedule-form">
                <div class="form-group">
                    <label for="instructor-schedule-program" class="form-label">프로그램 선택 *</label>
                    <select id="instructor-schedule-program" class="form-input" required>
                        <option value="">프로그램을 선택하세요</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">일정 추가 (여러 일정을 한 번에 추가할 수 있습니다) *</label>
                    <div id="instructor-schedule-dates-container">
                        <div class="schedule-date-item" style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem; align-items: center;">
                            <input type="date" class="form-input instructor-schedule-date-input" required style="flex: 1;">
                            <button type="button" class="btn btn-sm" style="background: #ef4444; color: white; border: none; display: none;" onclick="removeInstructorScheduleDate(this)">삭제</button>
                        </div>
                    </div>
                    <button type="button" class="btn btn-outline btn-sm" onclick="addInstructorScheduleDate()" style="margin-top: 0.5rem;">+ 일정 추가</button>
                </div>
                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="checkbox" id="instructor-schedule-active" checked>
                        <span>활성화</span>
                    </label>
                </div>
                <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 1.5rem;">
                    <button type="button" id="cancel-instructor-schedule-btn" class="btn btn-outline">취소</button>
                    <button type="submit" id="save-instructor-schedule-btn" class="btn btn-primary">저장</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Consult Schedule Modal -->
    <div id="consult-schedule-modal" style="display: none; position: fixed; inset: 0; background: rgba(0, 0, 0, 0.5); z-index: 1000; align-items: center; justify-content: center;">
        <div id="consult-schedule-modal-backdrop" style="position: absolute; inset: 0; cursor: pointer;"></div>
        <div style="position: relative; z-index: 1001; background: white; border-radius: 0.5rem; padding: 2rem; max-width: 700px; max-height: 90vh; overflow-y: auto; margin: 1rem; width: 100%;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2 style="margin: 0;" id="consult-schedule-modal-title">상담 일정 추가</h2>
                <button id="close-consult-schedule-modal" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; padding: 0; width: 2rem; height: 2rem; display: flex; align-items: center; justify-content: center;">&times;</button>
            </div>
            <form id="consult-schedule-form">
                <div class="form-group">
                    <label for="consult-schedule-course" class="form-label">과정 선택 *</label>
                    <select id="consult-schedule-course" class="form-input" required>
                        <option value="">과정을 선택하세요</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">일정 및 시간 추가 (여러 일정을 한 번에 추가할 수 있습니다) *</label>
                    <div id="consult-schedule-items-container">
                        <div class="consult-schedule-item" style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem; align-items: center;">
                            <input type="date" class="form-input consult-schedule-date-input" required style="flex: 1;">
                            <select class="form-input consult-schedule-time-input" required style="width: 120px;">
                                <option value="">시간 선택</option>
                                <option value="09:00">09:00</option>
                                <option value="10:00">10:00</option>
                                <option value="11:00">11:00</option>
                                <option value="12:00">12:00</option>
                                <option value="13:00">13:00</option>
                                <option value="14:00">14:00</option>
                                <option value="15:00">15:00</option>
                                <option value="16:00">16:00</option>
                                <option value="17:00">17:00</option>
                                <option value="18:00">18:00</option>
                                <option value="19:00">19:00</option>
                                <option value="20:00">20:00</option>
                            </select>
                            <button type="button" class="btn btn-sm" style="background: #ef4444; color: white; border: none; display: none;" onclick="removeConsultScheduleItem(this)">삭제</button>
                        </div>
                    </div>
                    <button type="button" class="btn btn-outline btn-sm" onclick="addConsultScheduleItem()" style="margin-top: 0.5rem;">+ 일정 추가</button>
                </div>
                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="checkbox" id="consult-schedule-active" checked>
                        <span>활성화</span>
                    </label>
                </div>
                <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 1.5rem;">
                    <button type="button" id="cancel-consult-schedule-btn" class="btn btn-outline">취소</button>
                    <button type="submit" id="save-consult-schedule-btn" class="btn btn-primary">저장</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Course Price Modal -->
    <div id="course-price-modal" style="display: none; position: fixed; inset: 0; background: rgba(0, 0, 0, 0.5); z-index: 1000; align-items: center; justify-content: center;">
        <div id="course-price-modal-backdrop" style="position: absolute; inset: 0; cursor: pointer;"></div>
        <div style="position: relative; z-index: 1001; background: white; border-radius: 0.5rem; padding: 2rem; max-width: 600px; max-height: 90vh; overflow-y: auto; margin: 1rem; width: 100%;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2 style="margin: 0;" id="course-price-modal-title">과정 가격 설정</h2>
                <button id="close-course-price-modal" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; padding: 0; width: 2rem; height: 2rem; display: flex; align-items: center; justify-content: center;">&times;</button>
            </div>
            <form id="course-price-form">
                <div class="form-group">
                    <label for="course-price-select" class="form-label">과정 선택 *</label>
                    <select id="course-price-select" class="form-input" required>
                        <option value="">과정을 선택하세요</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="course-price-amount" class="form-label">가격 (원) *</label>
                    <input type="number" id="course-price-amount" class="form-input" min="0" step="1000" placeholder="가격을 입력하세요" required>
                </div>
                <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 1.5rem;">
                    <button type="button" id="cancel-course-price-btn" class="btn btn-outline">취소</button>
                    <button type="submit" id="save-course-price-btn" class="btn btn-primary">저장</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Scripts -->
    <!-- Courses Data -->
    <script src="../js/courses-data.js"></script>
    <!-- SheetJS 라이브러리 (엑셀 파일 생성용) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        // Prevent components.js from loading header in admin page
        $(document).ready(function() {
            // Remove any header-container that might be created
            $('#header-container').remove();
            
            // Check for resource loading errors
            window.addEventListener('error', function(e) {
                if (e.target.tagName === 'LINK' || e.target.tagName === 'SCRIPT' || e.target.tagName === 'IMG') {
                    console.error('Resource loading error:', e.target.src || e.target.href, e.message);
                    // Try to fix image path if it's the logo
                    if (e.target.tagName === 'IMG' && e.target.src.includes('logo')) {
                        // Try alternative path
                        const img = e.target;
                        const originalSrc = img.getAttribute('data-original-src') || img.src;
                        if (!img.getAttribute('data-retried')) {
                            img.setAttribute('data-retried', 'true');
                            // Try URL encoded version
                            const encodedSrc = originalSrc.replace(/[가-힣]/g, function(match) {
                                return encodeURIComponent(match);
                            });
                            img.src = encodedSrc;
                        } else {
                            // Hide image if retry also failed
                            img.style.display = 'none';
                        }
                    }
                }
            }, true);
        });
    </script>
    <script>
        // Admin credentials (in production, this should be server-side)
        const ADMIN_CREDENTIALS = {
            username: 'admin',
            password: 'admin1234'
        };

        let currentApplicationId = null;
        let currentInquiryId = null;
        let currentNoticeId = null;
        let applications = [];
        let users = [];
        let inquiries = [];
        let notices = [];
        let loginHistory = [];
        let courses = [];
        let schedules = [];
        let instructorPrograms = [];
        let instructorSchedules = [];
        let consultSchedules = [];
        let currentScheduleId = null;
        let currentScheduleType = null;
        let currentInstructorScheduleId = null;
        let currentConsultScheduleId = null;

        // Check if already logged in
        $(document).ready(function() {
            // 초기 상태 설정 - 로그인 화면 표시
            $('#login-screen').show();
            $('#admin-dashboard').hide();
            
            const isLoggedIn = sessionStorage.getItem('adminLoggedIn') === 'true';
            if (isLoggedIn) {
                showDashboard();
            } else {
                showLogin();
            }

            // Login form handler
            $('#login-form').on('submit', function(e) {
                e.preventDefault();
                const username = $('#admin-username').val();
                const password = $('#admin-password').val();

                if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
                    sessionStorage.setItem('adminLoggedIn', 'true');
                    showDashboard();
                } else {
                    alert('아이디 또는 비밀번호가 올바르지 않습니다.');
                }
            });

            // Logout handler
            $('#logout-btn').on('click', function() {
                sessionStorage.removeItem('adminLoggedIn');
                showLogin();
            });

            // Refresh handler
            $('#refresh-btn').on('click', function() {
                loadApplications();
                loadUsers();
                loadInquiries();
                loadNotices();
                loadLoginHistory();
                // 현재 탭에 따라 해당 데이터도 새로고침
                const currentTab = $('.admin-tab.active').data('tab');
                if (currentTab === 'courses') {
                    loadCourses();
                } else if (currentTab === 'schedules') {
                    loadSchedules();
                } else if (currentTab === 'instructor-program') {
                    loadInstructorProgram();
                }
                alert('데이터를 새로고침했습니다.');
            });
            
            // Export handlers
            $('#export-applications-btn').on('click', function() {
                // 필터링된 데이터 가져오기
                const typeFilter = $('#type-filter').val();
                const searchTerm = $('#search-input').val().toLowerCase();
                
                let filtered = applications;
                
                // 거절된 항목은 목록에서 제외
                filtered = filtered.filter(a => a.status !== 'rejected');
                
                if (typeFilter) {
                    filtered = filtered.filter(a => a.applicationType === typeFilter);
                }
                if (searchTerm) {
                    filtered = filtered.filter(a => 
                        a.name.toLowerCase().includes(searchTerm) ||
                        a.email.toLowerCase().includes(searchTerm) ||
                        (a.phone && a.phone.includes(searchTerm))
                    );
                }
                exportToExcel(filtered, 'applications');
            });
            
            $('#export-users-btn').on('click', function() {
                // 필터링된 데이터 가져오기
                const searchTerm = $('#user-search-input').val().toLowerCase();
                let filtered = users;
                if (searchTerm) {
                    filtered = filtered.filter(u => 
                        u.email.toLowerCase().includes(searchTerm)
                    );
                }
                exportToExcel(filtered, 'users');
            });

            $('#export-inquiries-btn').on('click', function() {
                // 필터링된 데이터 가져오기
                const searchTerm = $('#inquiry-search-input').val().toLowerCase();
                let filtered = inquiries;
                if (searchTerm) {
                    filtered = filtered.filter(i => 
                        (i.title && i.title.toLowerCase().includes(searchTerm)) ||
                        (i.content && i.content.toLowerCase().includes(searchTerm)) ||
                        (i.author && i.author.toLowerCase().includes(searchTerm)) ||
                        (i.authorEmail && i.authorEmail.toLowerCase().includes(searchTerm))
                    );
                }
                exportToExcel(filtered, 'inquiries');
            });

            $('#export-login-history-btn').on('click', function() {
                // 필터링된 데이터 가져오기
                const searchTerm = $('#login-search-input').val().toLowerCase();
                const dateFrom = $('#login-date-from').val();
                const dateTo = $('#login-date-to').val();
                
                let filtered = loginHistory;
                
                if (searchTerm) {
                    filtered = filtered.filter(h => 
                        (h.userEmail && h.userEmail.toLowerCase().includes(searchTerm)) ||
                        (h.userName && h.userName.toLowerCase().includes(searchTerm))
                    );
                }
                
                if (dateFrom) {
                    const fromDate = new Date(dateFrom);
                    fromDate.setHours(0, 0, 0, 0);
                    filtered = filtered.filter(h => {
                        const loginDate = new Date(h.loginAt);
                        loginDate.setHours(0, 0, 0, 0);
                        return loginDate >= fromDate;
                    });
                }
                
                if (dateTo) {
                    const toDate = new Date(dateTo);
                    toDate.setHours(23, 59, 59, 999);
                    filtered = filtered.filter(h => {
                        const loginDate = new Date(h.loginAt);
                        return loginDate <= toDate;
                    });
                }
                
                exportToExcel(filtered, 'login-history');
            });

            // Tab handlers
            $('.admin-tab').on('click', function() {
                const tab = $(this).data('tab');
                switchTab(tab);
            });

            // Filter handlers
            $('#type-filter, #status-filter').on('change', filterApplications);
            $('#search-input').on('input', filterApplications);
            $('#user-search-input').on('input', filterUsers);
            $('#inquiry-search-input').on('input', filterInquiries);
            $('#login-search-input').on('input', filterLoginHistory);
            $('#login-date-from, #login-date-to').on('change', filterLoginHistory);

            // Login history selection mode handlers
            $('input[name="selection-mode"]').on('change', function() {
                updateSelectionMode();
            });

            // Login history selection handlers
            $(document).on('click', '#select-all-logins-btn', function() {
                $('.login-history-checkbox:visible').prop('checked', true);
                updateSelectAllCheckbox();
            });

            $(document).on('click', '#deselect-all-logins-btn', function() {
                $('.login-history-checkbox:visible').prop('checked', false);
                $('#select-all-logins-checkbox').prop('checked', false);
            });

            $(document).on('change', '#select-all-logins-checkbox', function() {
                const isChecked = $(this).is(':checked');
                $('.login-history-checkbox:visible').prop('checked', isChecked);
            });

            $(document).on('change', '.login-history-checkbox', function() {
                updateSelectAllCheckbox();
            });

            // Delete selected logins
            $(document).on('click', '#delete-selected-logins-btn', function() {
                const selectedIds = $('.login-history-checkbox:checked').map(function() {
                    return $(this).data('id');
                }).get();

                if (selectedIds.length === 0) {
                    alert('삭제할 항목을 선택해주세요.');
                    return;
                }

                if (confirm(`선택한 ${selectedIds.length}개의 로그인 이력을 삭제하시겠습니까?`)) {
                    deleteSelectedLoginHistory(selectedIds);
                }
            });

            // Delete period logins
            $(document).on('click', '#delete-period-logins-btn', function() {
                const dateFrom = $('#login-date-from').val();
                const dateTo = $('#login-date-to').val();

                if (!dateFrom || !dateTo) {
                    alert('삭제할 기간을 선택해주세요. (시작일과 종료일 모두 필요)');
                    return;
                }

                const fromDate = new Date(dateFrom);
                fromDate.setHours(0, 0, 0, 0);
                const toDate = new Date(dateTo);
                toDate.setHours(23, 59, 59, 999);

                const periodRecords = loginHistory.filter(h => {
                    const loginDate = new Date(h.loginAt);
                    return loginDate >= fromDate && loginDate <= toDate;
                });

                if (periodRecords.length === 0) {
                    alert('선택한 기간에 해당하는 로그인 이력이 없습니다.');
                    return;
                }

                if (confirm(`선택한 기간(${dateFrom} ~ ${dateTo})의 ${periodRecords.length}개 로그인 이력을 삭제하시겠습니까?`)) {
                    const periodIds = periodRecords.map(r => r.id);
                    deleteSelectedLoginHistory(periodIds);
                }
            });

            // Modal handlers
            function closeModal() {
                $('#detail-modal').css('display', 'none');
                currentApplicationId = null;
                currentInquiryId = null;
            }
            
            $('#close-modal').on('click', function(e) {
                e.stopPropagation();
                closeModal();
            });
            
            $('#modal-backdrop').on('click', function() {
                closeModal();
            });
            
            // ESC 키로 모달 닫기
            $(document).on('keydown', function(e) {
                if (e.key === 'Escape' && $('#detail-modal').is(':visible')) {
                    closeModal();
                }
            });

            $('#approve-btn').on('click', function() {
                if (currentApplicationId) {
                    updateApplicationStatus(currentApplicationId, 'approved');
                }
            });

            $('#reject-btn').on('click', function() {
                if (currentApplicationId) {
                    updateApplicationStatus(currentApplicationId, 'rejected');
                }
            });

            // Notice handlers
            $('#create-notice-btn').on('click', function() {
                currentNoticeId = null;
                $('#notice-modal-title').text('공지사항 작성');
                $('#notice-form')[0].reset();
                $('#notice-published').prop('checked', true);
                $('#notice-modal').css('display', 'flex');
            });

            $('#close-notice-modal, #notice-modal-backdrop, #cancel-notice-btn').on('click', function() {
                $('#notice-modal').css('display', 'none');
                currentNoticeId = null;
            });

            $('#save-notice-draft-btn').on('click', function() {
                saveNotice(false);
            });

            $('#notice-form').on('submit', function(e) {
                e.preventDefault();
                const isPublished = $('#notice-published').is(':checked');
                saveNotice(isPublished);
            });

            $('#notice-search-input').on('input', filterNotices);

            // Load data on dashboard show
            if (isLoggedIn) {
                loadApplications();
                loadUsers();
                loadInquiries();
                loadNotices();
                loadLoginHistory();
            }
        });

        function switchTab(tab) {
            // Update tab buttons
            $('.admin-tab').removeClass('active').css({
                'border-bottom': 'none',
                'color': 'var(--text-muted)'
            });
            $(`.admin-tab[data-tab="${tab}"]`).addClass('active').css({
                'border-bottom': '2px solid var(--primary)',
                'color': 'var(--primary)'
            });

            // Show/hide sections and export buttons
            if (tab === 'applications') {
                $('#applications-section').show();
                $('#users-section').hide();
                $('#inquiries-section').hide();
                $('#notices-section').hide();
                $('#login-history-section').hide();
                $('#courses-section').hide();
                $('#schedules-section').hide();
                $('#instructor-program-section').hide();
                $('#export-applications-btn').show();
                $('#export-users-btn').hide();
                $('#export-inquiries-btn').hide();
                $('#export-login-history-btn').hide();
            } else if (tab === 'users') {
                $('#applications-section').hide();
                $('#users-section').show();
                $('#inquiries-section').hide();
                $('#notices-section').hide();
                $('#login-history-section').hide();
                $('#courses-section').hide();
                $('#schedules-section').hide();
                $('#instructor-program-section').hide();
                $('#export-applications-btn').hide();
                $('#export-users-btn').show();
                $('#export-inquiries-btn').hide();
                $('#export-login-history-btn').hide();
                loadUsers();
            } else if (tab === 'inquiries') {
                $('#applications-section').hide();
                $('#users-section').hide();
                $('#inquiries-section').show();
                $('#notices-section').hide();
                $('#login-history-section').hide();
                $('#courses-section').hide();
                $('#schedules-section').hide();
                $('#instructor-program-section').hide();
                $('#export-applications-btn').hide();
                $('#export-users-btn').hide();
                $('#export-inquiries-btn').show();
                $('#export-login-history-btn').hide();
                loadInquiries();
            } else if (tab === 'notices') {
                $('#applications-section').hide();
                $('#users-section').hide();
                $('#inquiries-section').hide();
                $('#notices-section').show();
                $('#login-history-section').hide();
                $('#courses-section').hide();
                $('#schedules-section').hide();
                $('#instructor-program-section').hide();
                $('#export-applications-btn').hide();
                $('#export-users-btn').hide();
                $('#export-inquiries-btn').hide();
                $('#export-login-history-btn').hide();
                loadNotices();
            } else if (tab === 'login-history') {
                $('#applications-section').hide();
                $('#users-section').hide();
                $('#inquiries-section').hide();
                $('#notices-section').hide();
                $('#login-history-section').show();
                $('#courses-section').hide();
                $('#schedules-section').hide();
                $('#instructor-program-section').hide();
                $('#export-applications-btn').hide();
                $('#export-users-btn').hide();
                $('#export-inquiries-btn').hide();
                $('#export-login-history-btn').show();
                loadLoginHistory();
            } else if (tab === 'courses') {
                $('#applications-section').hide();
                $('#users-section').hide();
                $('#inquiries-section').hide();
                $('#notices-section').hide();
                $('#login-history-section').hide();
                $('#courses-section').show();
                $('#schedules-section').hide();
                $('#instructor-program-section').hide();
                $('#export-applications-btn').hide();
                $('#export-users-btn').hide();
                $('#export-inquiries-btn').hide();
                $('#export-login-history-btn').hide();
                loadCourses();
            } else if (tab === 'schedules') {
                $('#applications-section').hide();
                $('#users-section').hide();
                $('#inquiries-section').hide();
                $('#notices-section').hide();
                $('#login-history-section').hide();
                $('#courses-section').hide();
                $('#schedules-section').show();
                $('#instructor-program-section').hide();
                $('#export-applications-btn').hide();
                $('#export-users-btn').hide();
                $('#export-inquiries-btn').hide();
                $('#export-login-history-btn').hide();
                loadSchedules();
            } else if (tab === 'instructor-program') {
                $('#applications-section').hide();
                $('#users-section').hide();
                $('#inquiries-section').hide();
                $('#notices-section').hide();
                $('#login-history-section').hide();
                $('#courses-section').hide();
                $('#schedules-section').hide();
                $('#instructor-program-section').show();
                $('#export-applications-btn').hide();
                $('#export-users-btn').hide();
                $('#export-inquiries-btn').hide();
                $('#export-login-history-btn').hide();
                loadInstructorProgram();
            }
        }

        function showLogin() {
            $('#login-screen').show();
            $('#admin-dashboard').hide();
            $('#admin-username').val('');
            $('#admin-password').val('');
        }

        function showDashboard() {
            $('#login-screen').hide();
            $('#admin-dashboard').show();
            loadApplications();
            loadUsers();
            loadInquiries();
            loadNotices();
            loadLoginHistory();
        }

        function loadUsers() {
            try {
                const stored = localStorage.getItem('users');
                console.log('Loading users from localStorage:', stored ? 'found' : 'not found');
                if (stored) {
                    let parsed;
                    try {
                        parsed = JSON.parse(stored);
                    } catch (parseError) {
                        console.error('Error parsing users JSON:', parseError);
                        console.error('Raw data:', stored);
                        users = [];
                        updateUserStatistics();
                        filterUsers();
                        return;
                    }
                    
                    console.log('Parsed users:', parsed);
                    console.log('Is array?', Array.isArray(parsed));
                    
                    // 데이터 유효성 검사
                    if (Array.isArray(parsed)) {
                        users = parsed.filter(u => {
                            // 필수 필드 확인
                            const isValid = u && typeof u === 'object' && u.email && u.registeredAt;
                            if (!isValid) {
                                console.warn('Invalid user data filtered out:', u);
                            }
                            return isValid;
                        });
                    } else {
                        console.error('Users data is not an array:', typeof parsed);
                        users = [];
                    }
                    
                    console.log('Filtered users count:', users.length);
                    
                    // Sort by date (newest first)
                    users.sort((a, b) => {
                        try {
                            const dateA = new Date(a.registeredAt);
                            const dateB = new Date(b.registeredAt);
                            if (isNaN(dateA.getTime()) || isNaN(dateB.getTime())) {
                                console.warn('Invalid date found:', { a: a.registeredAt, b: b.registeredAt });
                                return 0;
                            }
                            return dateB - dateA;
                        } catch (e) {
                            console.error('Error sorting users:', e);
                            return 0;
                        }
                    });
                    
                    console.log('Final users array:', users);
                } else {
                    users = [];
                    console.log('No users found in localStorage');
                }
                
                updateUserStatistics();
                filterUsers();
            } catch (e) {
                console.error('Error loading users:', e);
                console.error('Error stack:', e.stack);
                users = [];
                updateUserStatistics();
                filterUsers();
            }
        }

        function updateUserStatistics() {
            const total = users.length;
            // 승인된 회원만 활성으로 계산
            const active = users.filter(u => u.approved === true || u.status === 'approved').length;

            $('#total-users').text(total);
            $('#active-users').text(active);
        }

        // 회원 승인 함수
        function approveUser(id) {
            console.log('approveUser called with id:', id, 'type:', typeof id);
            try {
                // localStorage에서 직접 읽어와서 승인
                const stored = localStorage.getItem('users');
                if (!stored) {
                    alert('회원 목록을 찾을 수 없습니다.');
                    return;
                }
                
                let userList = JSON.parse(stored);
                console.log('Current users:', userList.length);
                
                // ID를 문자열로 변환하여 비교
                const userIndex = userList.findIndex(u => {
                    if (!u || !u.id) return false;
                    return String(u.id) === String(id);
                });
                console.log('Found index:', userIndex);
                
                if (userIndex === -1) {
                    alert('회원을 찾을 수 없습니다. ID: ' + id);
                    return;
                }

                // 회원 승인 처리
                userList[userIndex].approved = true;
                userList[userIndex].status = 'approved';
                console.log('User approved:', userList[userIndex]);
                
                // localStorage에 저장
                localStorage.setItem('users', JSON.stringify(userList));
                
                // 데이터 다시 로드하여 화면 갱신 (가장 확실한 방법)
                loadUsers();
                
                alert('회원이 승인되었습니다.');
            } catch (e) {
                console.error('Error approving user:', e);
                alert('승인 중 오류가 발생했습니다: ' + e.message);
            }
        }

        function filterUsers() {
            const searchTerm = $('#user-search-input').val().toLowerCase();

            let filtered = users;

            if (searchTerm) {
                filtered = filtered.filter(u => 
                    u.email.toLowerCase().includes(searchTerm)
                );
            }

            renderUsers(filtered);
        }

        function renderUsers(userList) {
            const tbody = $('#users-tbody');
            tbody.empty();

            if (userList.length === 0) {
                tbody.html('<tr><td colspan="7" class="no-applications">회원이 없습니다.</td></tr>');
                return;
            }

            userList.forEach(user => {
                const date = new Date(user.registeredAt);
                const dateStr = date.toLocaleDateString('ko-KR') + ' ' + 
                               date.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
                
                // 승인 상태 확인 (approved 필드 또는 status 필드)
                const isApproved = user.approved === true || user.status === 'approved';
                const statusClass = isApproved ? 'status-approved' : 'status-pending';
                const statusText = isApproved ? '승인됨' : '대기 중';
                
                // 가입 방법 표시 (소셜 로그인 제거됨)
                const authMethod = '일반';

                const row = $(`
                    <tr>
                        <td>${dateStr}</td>
                        <td>${user.name || '-'}</td>
                        <td>${user.email || '-'}</td>
                        <td>${user.phone || '-'}</td>
                        <td>${authMethod}</td>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                        <td>
                            ${!isApproved ? `<button class="btn btn-sm btn-primary approve-user-btn" style="margin-right: 0.5rem;" data-id="${user.id}" data-action="approve-user">승인</button>` : ''}
                            <button class="btn btn-sm delete-user-btn" style="background: #ef4444; color: white; border: none;" data-id="${user.id}" data-action="delete-user">삭제</button>
                        </td>
                    </tr>
                `);

                // 승인 버튼 이벤트
                if (!isApproved) {
                    row.find('[data-action="approve-user"]').on('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        const id = $(this).data('id');
                        console.log('Approve user button clicked, id:', id);
                        if (confirm('이 회원을 승인하시겠습니까?')) {
                            approveUser(id);
                        }
                    });
                }

                row.find('[data-action="delete-user"]').on('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const id = $(this).data('id');
                    console.log('Delete user button clicked, id:', id);
                    if (confirm('정말로 이 회원을 삭제하시겠습니까?')) {
                        deleteUser(id);
                    }
                });

                tbody.append(row);
            });
        }

        function loadApplications() {
            try {
                const stored = localStorage.getItem('applications');
                if (stored) {
                    const parsed = JSON.parse(stored);
                    // 데이터 유효성 검사
                    applications = Array.isArray(parsed) ? parsed.filter(a => {
                        // 필수 필드 확인
                        return a && a.id && a.submittedAt && a.email;
                    }) : [];
                    // Sort by date (newest first)
                    applications.sort((a, b) => new Date(b.submittedAt) - new Date(a.submittedAt));
                } else {
                    applications = [];
                }
                updateStatistics();
                filterApplications();
            } catch (e) {
                console.error('Error loading applications:', e);
                applications = [];
                updateStatistics();
                filterApplications();
            }
        }

        function updateStatistics() {
            const total = applications.length;
            const pending = applications.filter(a => a.status === 'pending').length;
            const approved = applications.filter(a => a.status === 'approved').length;
            const rejected = applications.filter(a => a.status === 'rejected').length;

            $('#total-count').text(total);
            $('#pending-count').text(pending);
            $('#approved-count').text(approved);
            $('#rejected-count').text(rejected);
        }

        function filterApplications() {
            const typeFilter = $('#type-filter').val();
            const searchTerm = $('#search-input').val().toLowerCase();

            let filtered = applications;

            // 거절된 항목은 목록에서 제외
            filtered = filtered.filter(a => a.status !== 'rejected');

            if (typeFilter) {
                filtered = filtered.filter(a => a.applicationType === typeFilter);
            }

            if (searchTerm) {
                filtered = filtered.filter(a => 
                    a.name.toLowerCase().includes(searchTerm) ||
                    a.email.toLowerCase().includes(searchTerm) ||
                    (a.phone && a.phone.includes(searchTerm))
                );
            }

            renderApplications(filtered);
        }

        function renderApplications(apps) {
            const tbody = $('#applications-tbody');
            tbody.empty();

            if (apps.length === 0) {
                tbody.html('<tr><td colspan="7" class="no-applications">신청 내역이 없습니다.</td></tr>');
                return;
            }

            apps.forEach(app => {
                const date = new Date(app.submittedAt);
                const dateStr = date.toLocaleDateString('ko-KR') + ' ' + 
                               date.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
                
                const statusClass = `status-${app.status || 'pending'}`;
                const statusText = {
                    'pending': '대기 중',
                    'approved': '승인됨',
                    'rejected': '거절됨'
                }[app.status || 'pending'] || '대기 중';

                const typeText = {
                    'student': '강의신청',
                    'instructor': '강사 신청',
                    'consult': '상담신청'
                }[app.applicationType] || app.applicationType;

                const row = $(`
                    <tr>
                        <td>${dateStr}</td>
                        <td>${app.name}</td>
                        <td>${app.email}</td>
                        <td>${app.phone || '-'}</td>
                        <td>${app.courseTitle || typeText}</td>
                        <td>${app.preferredSchedule || '-'} ${app.preferredTime || ''}</td>
                        <td>
                            <button class="btn btn-sm btn-outline view-detail" data-id="${app.id}" style="margin-right: 0.5rem;">상세보기</button>
                            <button class="btn btn-sm delete-application-btn" style="background: #ef4444; color: white; border: none;" data-id="${app.id}" data-action="delete-application">삭제</button>
                        </td>
                    </tr>
                `);

                row.find('.view-detail').on('click', function() {
                    showApplicationDetail(app.id);
                });

                row.find('[data-action="delete-application"]').on('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const id = $(this).data('id');
                    console.log('Delete application button clicked, id:', id);
                    if (confirm('정말로 이 신청 내역을 삭제하시겠습니까?')) {
                        deleteApplication(id);
                    }
                });

                tbody.append(row);
            });
        }

        function showApplicationDetail(id) {
            const app = applications.find(a => a.id === id);
            if (!app) return;

            currentApplicationId = id;
            
            // 모달 제목 설정
            $('#detail-modal-title').text('신청 상세 정보');
            
            // 승인/거절 버튼 표시 (대기 중인 경우에만)
            if (app.status === 'pending') {
                $('#approve-btn, #reject-btn').show();
            } else {
                $('#approve-btn, #reject-btn').hide();
            }

            const date = new Date(app.submittedAt);
            const dateStr = date.toLocaleDateString('ko-KR') + ' ' + 
                           date.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });

            const detailHtml = `
                <div class="detail-row">
                    <div class="detail-label">신청일시</div>
                    <div>${dateStr}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">신청 유형</div>
                    <div>${app.courseTitle || (app.applicationType === 'consult' ? 'Zoom 상담 신청' : app.applicationType === 'instructor' ? '강사 성장 프로그램' : '학생 신청')}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">희망 일정</div>
                    <div>${app.preferredSchedule || '-'} ${app.preferredTime || ''}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">이름</div>
                    <div>${app.name}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">이메일</div>
                    <div>${app.email}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">연락처</div>
                    <div>${app.phone || '-'}</div>
                </div>
                ${app.organization ? `
                <div class="detail-row">
                    <div class="detail-label">소속</div>
                    <div>${app.organization}</div>
                </div>
                ` : ''}
                <div class="detail-row">
                    <div class="detail-label">직무</div>
                    <div>${app.position || '-'}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">상태</div>
                    <div><span class="status-badge status-${app.status || 'pending'}">${app.status === 'approved' ? '승인됨' : app.status === 'rejected' ? '거절됨' : '대기 중'}</span></div>
                </div>
            `;

            $('#detail-content').html(detailHtml);
            $('#detail-modal').css('display', 'flex');
        }

        function updateApplicationStatus(id, status) {
            const appIndex = applications.findIndex(a => a.id === id);
            if (appIndex === -1) {
                alert('신청을 찾을 수 없습니다.');
                return;
            }

            applications[appIndex].status = status;
            
            try {
                localStorage.setItem('applications', JSON.stringify(applications));
                $('#detail-modal').css('display', 'none');
                currentApplicationId = null;
                loadApplications();
                alert(`신청이 ${status === 'approved' ? '승인' : '거절'}되었습니다.`);
            } catch (e) {
                console.error('Error updating application:', e);
                alert('상태 업데이트 중 오류가 발생했습니다. localStorage 용량을 확인해주세요.');
            }
        }

        // 신청 내역 삭제 함수
        function deleteApplication(id) {
            console.log('deleteApplication called with id:', id, 'type:', typeof id);
            try {
                // localStorage에서 직접 읽어와서 삭제
                const stored = localStorage.getItem('applications');
                if (!stored) {
                    alert('신청 내역을 찾을 수 없습니다.');
                    return;
                }
                
                let apps = JSON.parse(stored);
                console.log('Current applications:', apps.length);
                
                // ID를 문자열로 변환하여 비교
                const appIndex = apps.findIndex(a => {
                    if (!a || !a.id) return false;
                    return String(a.id) === String(id);
                });
                console.log('Found index:', appIndex);
                
                if (appIndex === -1) {
                    alert('신청을 찾을 수 없습니다. ID: ' + id);
                    return;
                }

                // 배열에서 삭제
                apps.splice(appIndex, 1);
                console.log('After delete, applications:', apps.length);
                
                // localStorage에 저장
                localStorage.setItem('applications', JSON.stringify(apps));
                
                // 데이터 다시 로드하여 화면 갱신 (가장 확실한 방법)
                loadApplications();
                
                alert('신청 내역이 삭제되었습니다.');
            } catch (e) {
                console.error('Error deleting application:', e);
                alert('삭제 중 오류가 발생했습니다: ' + e.message);
            }
        }

        // 회원 삭제 함수
        function deleteUser(id) {
            console.log('deleteUser called with id:', id, 'type:', typeof id);
            try {
                // localStorage에서 직접 읽어와서 삭제
                const stored = localStorage.getItem('users');
                if (!stored) {
                    alert('회원 목록을 찾을 수 없습니다.');
                    return;
                }
                
                let userList = JSON.parse(stored);
                console.log('Current users:', userList.length);
                
                // ID를 문자열로 변환하여 비교
                const userIndex = userList.findIndex(u => {
                    if (!u || !u.id) return false;
                    return String(u.id) === String(id);
                });
                console.log('Found index:', userIndex);
                
                if (userIndex === -1) {
                    alert('회원을 찾을 수 없습니다. ID: ' + id);
                    return;
                }

                // 배열에서 삭제
                userList.splice(userIndex, 1);
                console.log('After delete, users:', userList.length);
                
                // localStorage에 저장
                localStorage.setItem('users', JSON.stringify(userList));
                
                // 데이터 다시 로드하여 화면 갱신 (가장 확실한 방법)
                loadUsers();
                
                alert('회원이 삭제되었습니다.');
            } catch (e) {
                console.error('Error deleting user:', e);
                alert('삭제 중 오류가 발생했습니다: ' + e.message);
            }
        }

        // 문의 삭제 함수
        function deleteInquiry(id) {
            console.log('deleteInquiry called with id:', id);
            try {
                // localStorage에서 직접 읽어와서 삭제
                const stored = localStorage.getItem('inquiries');
                if (!stored) {
                    alert('문의 목록을 찾을 수 없습니다.');
                    return;
                }
                
                let inquiryList = JSON.parse(stored);
                console.log('Current inquiries:', inquiryList.length);
                console.log('Looking for id:', id, 'Type:', typeof id);
                console.log('All inquiry ids:', inquiryList.map(i => ({id: i.id, type: typeof i.id})));
                
                const inquiryIndex = inquiryList.findIndex(i => {
                    if (!i || !i.id) return false;
                    // ID를 문자열로 비교
                    return String(i.id) === String(id);
                });
                console.log('Found index:', inquiryIndex);
                
                if (inquiryIndex === -1) {
                    alert('문의를 찾을 수 없습니다. ID: ' + id);
                    return;
                }

                // 배열에서 삭제
                inquiryList.splice(inquiryIndex, 1);
                console.log('After delete, inquiries:', inquiryList.length);
                
                // localStorage에 저장
                localStorage.setItem('inquiries', JSON.stringify(inquiryList));
                
                // 전역 배열 업데이트
                inquiries = inquiryList;
                
                // 통계 업데이트
                updateInquiryStatistics();
                
                // 필터 조건 적용하여 즉시 렌더링
                const searchTerm = $('#inquiry-search-input').val().toLowerCase();
                let filtered = inquiries;
                if (searchTerm) {
                    filtered = filtered.filter(i => 
                        (i.title && i.title.toLowerCase().includes(searchTerm)) ||
                        (i.content && i.content.toLowerCase().includes(searchTerm)) ||
                        (i.author && i.author.toLowerCase().includes(searchTerm)) ||
                        (i.authorEmail && i.authorEmail.toLowerCase().includes(searchTerm))
                    );
                }
                
                console.log('Filtered inquiries:', filtered.length);
                
                // 테이블 완전히 비우고 다시 렌더링
                const tbody = $('#inquiries-tbody');
                tbody.empty();
                renderInquiries(filtered);
                
                console.log('Rendering complete');
                alert('문의가 삭제되었습니다.');
            } catch (e) {
                console.error('Error deleting inquiry:', e);
                alert('삭제 중 오류가 발생했습니다: ' + e.message);
            }
        }
        
        // 엑셀 내보내기 함수
        function exportToExcel(data, type) {
            if (!data || data.length === 0) {
                alert('내보낼 데이터가 없습니다.');
                return;
            }
            
            // SheetJS 라이브러리 확인
            if (typeof XLSX === 'undefined') {
                alert('엑셀 내보내기 기능을 사용할 수 없습니다. 페이지를 새로고침해주세요.');
                return;
            }
            
            let headers = [];
            let rows = [];
            
            if (type === 'applications') {
                headers = ['신청일시', '이름', '이메일', '연락처', '과정/유형', '희망일정', '희망시간', '소속', '직무', '상태'];
                data.forEach(app => {
                    const date = new Date(app.submittedAt);
                    const dateStr = date.toLocaleDateString('ko-KR') + ' ' + 
                                   date.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
                    const statusText = {
                        'pending': '대기 중',
                        'approved': '승인됨',
                        'rejected': '거절됨'
                    }[app.status || 'pending'] || '대기 중';
                    
                    rows.push([
                        dateStr,
                        app.name || '',
                        app.email || '',
                        app.phone || '',
                        app.courseTitle || app.applicationType || '',
                        app.preferredSchedule || '',
                        app.preferredTime || '',
                        app.organization || '',
                        app.position || '',
                        statusText
                    ]);
                });
            } else if (type === 'users') {
                headers = ['가입일시', '이름', '이메일', '전화번호', '가입방법', '상태'];
                data.forEach(user => {
                    const date = new Date(user.registeredAt);
                    const dateStr = date.toLocaleDateString('ko-KR') + ' ' + 
                                   date.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
                    const authMethod = '일반';
                    const statusText = user.status === 'active' ? '활성' : '비활성';
                    
                    rows.push([
                        dateStr,
                        user.name || '',
                        user.email || '',
                        user.phone || '',
                        authMethod,
                        statusText
                    ]);
                });
            } else if (type === 'inquiries') {
                headers = ['작성일시', '제목', '작성자', '이메일', '내용', '답변 수'];
                data.forEach(inquiry => {
                    const date = new Date(inquiry.createdAt);
                    const dateStr = date.toLocaleDateString('ko-KR') + ' ' + 
                                   date.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
                    const answerCount = inquiry.answers ? inquiry.answers.length : 0;
                    const contentPreview = inquiry.content ? (inquiry.content.length > 100 ? inquiry.content.substring(0, 100) + '...' : inquiry.content) : '';
                    
                    rows.push([
                        dateStr,
                        inquiry.title || '',
                        inquiry.author || '',
                        inquiry.authorEmail || '',
                        contentPreview,
                        answerCount
                    ]);
                });
            } else if (type === 'login-history') {
                headers = ['로그인 일시', '이름', '이메일', 'IP 주소', '브라우저'];
                data.forEach(record => {
                    if (!record.loginAt) return;
                    const date = new Date(record.loginAt);
                    if (isNaN(date.getTime())) return;
                    
                    const dateStr = date.toLocaleDateString('ko-KR') + ' ' + 
                                   date.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
                    
                    // User Agent에서 브라우저 정보 추출
                    let browserInfo = '알 수 없음';
                    if (record.userAgent) {
                        if (record.userAgent.includes('Chrome') && !record.userAgent.includes('Edg')) {
                            browserInfo = 'Chrome';
                        } else if (record.userAgent.includes('Firefox')) {
                            browserInfo = 'Firefox';
                        } else if (record.userAgent.includes('Safari') && !record.userAgent.includes('Chrome')) {
                            browserInfo = 'Safari';
                        } else if (record.userAgent.includes('Edg')) {
                            browserInfo = 'Edge';
                        } else if (record.userAgent.includes('Opera')) {
                            browserInfo = 'Opera';
                        } else {
                            browserInfo = record.userAgent.substring(0, 50) + '...';
                        }
                    }
                    
                    rows.push([
                        dateStr,
                        record.userName || '',
                        record.userEmail || '',
                        record.ipAddress || 'N/A',
                        browserInfo
                    ]);
                });
            }
            
            // 워크북 생성
            const wb = XLSX.utils.book_new();
            
            // 데이터 배열 생성 (헤더 + 데이터)
            const wsData = [headers, ...rows];
            
            // 워크시트 생성
            const ws = XLSX.utils.aoa_to_sheet(wsData);
            
            // 컬럼 너비 설정
            const colWidths = headers.map((header, idx) => {
                // 각 컬럼의 최대 길이 계산
                const maxLength = Math.max(
                    header.length,
                    ...rows.map(row => String(row[idx] || '').length)
                );
                return { wch: Math.min(Math.max(maxLength + 2, 10), 50) }; // 최소 10, 최대 50
            });
            ws['!cols'] = colWidths;
            
            // 워크시트를 워크북에 추가
            let sheetName = '데이터';
            if (type === 'applications') sheetName = '신청 내역';
            else if (type === 'users') sheetName = '회원 목록';
            else if (type === 'inquiries') sheetName = '문의 내역';
            else if (type === 'login-history') sheetName = '로그인 이력';
            
            XLSX.utils.book_append_sheet(wb, ws, sheetName);
            
            // 파일명 생성
            let fileName = '데이터';
            if (type === 'applications') fileName = '신청내역';
            else if (type === 'users') fileName = '회원목록';
            else if (type === 'inquiries') fileName = '문의내역';
            else if (type === 'login-history') fileName = '로그인이력';
            
            fileName = `${fileName}_${new Date().toISOString().split('T')[0]}.xlsx`;
            
            // 엑셀 파일 다운로드
            XLSX.writeFile(wb, fileName);
        }

        // 로그인 이력 관련 함수들
        function loadLoginHistory() {
            try {
                const stored = localStorage.getItem('loginHistory');
                console.log('Loading login history from localStorage:', stored ? 'found' : 'not found');
                
                if (stored) {
                    const parsed = JSON.parse(stored);
                    console.log('Parsed login history:', parsed);
                    
                    // 데이터 유효성 검사
                    loginHistory = Array.isArray(parsed) ? parsed.filter(h => {
                        // 필수 필드 확인
                        const isValid = h && h.id && h.loginAt && h.userEmail;
                        if (!isValid) {
                            console.warn('Invalid login history record:', h);
                        }
                        return isValid;
                    }) : [];
                    
                    console.log('Filtered login history:', loginHistory.length, 'valid records');
                    
                    // Sort by date (newest first)
                    loginHistory.sort((a, b) => {
                        const dateA = new Date(a.loginAt);
                        const dateB = new Date(b.loginAt);
                        return dateB - dateA;
                    });
                } else {
                    loginHistory = [];
                    console.log('No login history found in localStorage');
                }
                
                updateLoginHistoryStatistics();
                filterLoginHistory();
            } catch (e) {
                console.error('Error loading login history:', e);
                loginHistory = [];
                updateLoginHistoryStatistics();
                filterLoginHistory();
            }
        }

        function updateLoginHistoryStatistics() {
            const total = loginHistory.length;
            
            // 오늘 로그인 수 계산
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const todayLogins = loginHistory.filter(h => {
                const loginDateValue = h.loginAt || h.loginAt || h.createdAt || h.date;
                if (!loginDateValue) return false;
                const loginDate = new Date(loginDateValue);
                if (isNaN(loginDate.getTime())) return false;
                loginDate.setHours(0, 0, 0, 0);
                return loginDate.getTime() === today.getTime();
            }).length;
            
            // 고유 사용자 수 계산
            const uniqueEmails = new Set(loginHistory.map(h => h.userEmail));
            const uniqueUsers = uniqueEmails.size;

            $('#total-logins').text(total);
            $('#today-logins').text(todayLogins);
            $('#unique-users').text(uniqueUsers);
        }

        function filterLoginHistory() {
            const searchTerm = $('#login-search-input').val().toLowerCase();
            const dateFrom = $('#login-date-from').val();
            const dateTo = $('#login-date-to').val();

            let filtered = loginHistory;

            // 검색어 필터
            if (searchTerm) {
                filtered = filtered.filter(h => 
                    (h.userEmail && h.userEmail.toLowerCase().includes(searchTerm)) ||
                    (h.userName && h.userName.toLowerCase().includes(searchTerm))
                );
            }

            // 날짜 필터
            if (dateFrom) {
                const fromDate = new Date(dateFrom);
                fromDate.setHours(0, 0, 0, 0);
                filtered = filtered.filter(h => {
                    const loginDate = new Date(h.loginAt);
                    loginDate.setHours(0, 0, 0, 0);
                    return loginDate >= fromDate;
                });
            }

            if (dateTo) {
                const toDate = new Date(dateTo);
                toDate.setHours(23, 59, 59, 999);
                filtered = filtered.filter(h => {
                    const loginDate = new Date(h.loginAt);
                    return loginDate <= toDate;
                });
            }

            renderLoginHistory(filtered);
        }

        // 선택 모드 업데이트
        function updateSelectionMode() {
            const mode = $('input[name="selection-mode"]:checked').val();
            const isPartialMode = mode === 'partial';
            
            if (isPartialMode) {
                $('.login-history-checkbox').show();
                $('#select-all-logins-checkbox').show();
                $('#select-all-logins-btn').show();
                $('#deselect-all-logins-btn').show();
                $('#delete-selected-logins-btn').show();
            } else {
                $('.login-history-checkbox').hide();
                $('#select-all-logins-checkbox').hide();
                $('#select-all-logins-btn').hide();
                $('#deselect-all-logins-btn').hide();
                $('#delete-selected-logins-btn').hide();
            }
        }

        // 전체 선택 체크박스 업데이트
        function updateSelectAllCheckbox() {
            const totalCheckboxes = $('.login-history-checkbox:visible').length;
            const checkedCheckboxes = $('.login-history-checkbox:visible:checked').length;
            $('#select-all-logins-checkbox').prop('checked', totalCheckboxes > 0 && totalCheckboxes === checkedCheckboxes);
        }

        // 선택된 로그인 이력 삭제
        function deleteSelectedLoginHistory(ids) {
            if (!ids || ids.length === 0) {
                alert('삭제할 항목이 없습니다.');
                return;
            }

            // IDs를 Set으로 변환하여 빠른 검색
            const idsSet = new Set(ids);
            
            // 삭제할 항목 제거
            loginHistory = loginHistory.filter(h => !idsSet.has(h.id));
            
            try {
                localStorage.setItem('loginHistory', JSON.stringify(loginHistory));
                loadLoginHistory();
                alert(`${ids.length}개의 로그인 이력이 삭제되었습니다.`);
            } catch (e) {
                console.error('Error deleting login history:', e);
                alert('삭제 중 오류가 발생했습니다.');
            }
        }

        function renderLoginHistory(historyList) {
            const tbody = $('#login-history-tbody');
            tbody.empty();

            if (historyList.length === 0) {
                tbody.html('<tr><td colspan="6" class="no-applications">로그인 이력이 없습니다.</td></tr>');
                return;
            }

            historyList.forEach(record => {
                if (!record.loginAt) {
                    console.warn('Record missing loginAt:', record);
                    return;
                }
                
                const date = new Date(record.loginAt);
                if (isNaN(date.getTime())) {
                    console.warn('Invalid date in record:', record);
                    return;
                }
                
                const dateStr = date.toLocaleDateString('ko-KR') + ' ' + 
                               date.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
                
                // User Agent에서 브라우저 정보 추출
                let browserInfo = '알 수 없음';
                if (record.userAgent) {
                    if (record.userAgent.includes('Chrome') && !record.userAgent.includes('Edg')) {
                        browserInfo = 'Chrome';
                    } else if (record.userAgent.includes('Firefox')) {
                        browserInfo = 'Firefox';
                    } else if (record.userAgent.includes('Safari') && !record.userAgent.includes('Chrome')) {
                        browserInfo = 'Safari';
                    } else if (record.userAgent.includes('Edg')) {
                        browserInfo = 'Edge';
                    } else if (record.userAgent.includes('Opera')) {
                        browserInfo = 'Opera';
                    } else {
                        browserInfo = record.userAgent.substring(0, 50) + '...';
                    }
                }

                const row = $(`
                    <tr>
                        <td>
                            <input type="checkbox" class="login-history-checkbox" data-id="${record.id}" style="display: none;">
                        </td>
                        <td>${dateStr}</td>
                        <td>${record.userName || '-'}</td>
                        <td>${record.userEmail || '-'}</td>
                        <td>${record.ipAddress || 'N/A'}</td>
                        <td>${browserInfo}</td>
                    </tr>
                `);

                tbody.append(row);
            });
            
            // 선택 모드에 따라 체크박스 표시/숨김
            updateSelectionMode();
        }

        // 문의하기 관련 함수들
        function loadInquiries() {
            try {
                const stored = localStorage.getItem('inquiries');
                if (stored) {
                    const parsed = JSON.parse(stored);
                    // 데이터 유효성 검사
                    inquiries = Array.isArray(parsed) ? parsed.filter(i => {
                        // 필수 필드 확인
                        return i && i.id && i.title && i.content && i.createdAt;
                    }) : [];
                    // Sort by date (newest first)
                    inquiries.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                } else {
                    inquiries = [];
                }
                updateInquiryStatistics();
                filterInquiries();
            } catch (e) {
                console.error('Error loading inquiries:', e);
                inquiries = [];
                updateInquiryStatistics();
                filterInquiries();
            }
        }

        function updateInquiryStatistics() {
            const total = inquiries.length;
            const answered = inquiries.filter(i => i.answers && i.answers.length > 0).length;
            const pending = total - answered;

            $('#total-inquiries').text(total);
            $('#answered-inquiries').text(answered);
            $('#pending-inquiries').text(pending);
        }

        function filterInquiries() {
            const searchTerm = $('#inquiry-search-input').val().toLowerCase();

            let filtered = inquiries;

            if (searchTerm) {
                filtered = filtered.filter(i => 
                    (i.title && i.title.toLowerCase().includes(searchTerm)) ||
                    (i.content && i.content.toLowerCase().includes(searchTerm)) ||
                    (i.author && i.author.toLowerCase().includes(searchTerm)) ||
                    (i.authorEmail && i.authorEmail.toLowerCase().includes(searchTerm))
                );
            }

            renderInquiries(filtered);
        }

        function renderInquiries(inquiryList) {
            const tbody = $('#inquiries-tbody');
            tbody.empty();

            if (inquiryList.length === 0) {
                tbody.html('<tr><td colspan="6" class="no-applications">문의가 없습니다.</td></tr>');
                return;
            }

            inquiryList.forEach(inquiry => {
                const date = new Date(inquiry.createdAt);
                const dateStr = date.toLocaleDateString('ko-KR') + ' ' + 
                               date.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
                
                const answerCount = inquiry.answers ? inquiry.answers.length : 0;
                const titlePreview = inquiry.title.length > 30 ? inquiry.title.substring(0, 30) + '...' : inquiry.title;

                const row = $(`
                    <tr>
                        <td>${dateStr}</td>
                        <td>${titlePreview}</td>
                        <td>${inquiry.author || '-'}</td>
                        <td>${inquiry.authorEmail || '-'}</td>
                        <td>${answerCount}</td>
                        <td>
                            <button class="btn btn-sm btn-outline view-inquiry-detail" data-id="${inquiry.id}" style="margin-right: 0.5rem;">상세보기</button>
                            <button class="btn btn-sm" style="background: #ef4444; color: white; border: none;" data-id="${inquiry.id}" data-action="delete-inquiry">삭제</button>
                        </td>
                    </tr>
                `);

                row.find('.view-inquiry-detail').on('click', function() {
                    showInquiryDetail(inquiry.id);
                });

                row.find('[data-action="delete-inquiry"]').on('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const id = $(this).data('id');
                    console.log('Delete inquiry button clicked, id:', id);
                    if (confirm('정말로 이 문의를 삭제하시겠습니까?')) {
                        deleteInquiry(id);
                    }
                });

                tbody.append(row);
            });
        }

        function showInquiryDetail(id) {
            const inquiry = inquiries.find(i => i.id === id);
            if (!inquiry) return;

            currentInquiryId = id;
            
            // 모달 제목 설정
            $('#detail-modal-title').text('문의 상세 정보');

            const date = new Date(inquiry.createdAt);
            const dateStr = date.toLocaleDateString('ko-KR') + ' ' + 
                           date.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });

            let answersHtml = '';
            if (inquiry.answers && inquiry.answers.length > 0) {
                answersHtml = '<div style="margin-top: 2rem; padding-top: 2rem; border-top: 2px solid var(--border);"><h3 style="margin-bottom: 1rem; font-size: 1.125rem; font-weight: 600;">답변</h3>';
                inquiry.answers.forEach(function(answer) {
                    const answerDate = new Date(answer.createdAt);
                    const answerDateStr = answerDate.toLocaleDateString('ko-KR') + ' ' + 
                                         answerDate.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
                    answersHtml += `
                        <div style="padding: 1rem; background: #f9fafb; border-radius: 0.5rem; margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <span style="font-weight: 500;">${answer.author || '관리자'}</span>
                                <span style="font-size: 0.875rem; color: var(--text-muted);">${answerDateStr}</span>
                            </div>
                            <p style="line-height: 1.8; color: #171717; margin: 0; white-space: pre-line;">${answer.content}</p>
                        </div>
                    `;
                });
                answersHtml += '</div>';
            } else {
                answersHtml = '<div style="margin-top: 2rem; padding-top: 2rem; border-top: 2px solid var(--border);"><p style="color: var(--text-muted);">아직 답변이 없습니다.</p></div>';
            }

            // 답변 작성 폼
            const answerFormHtml = `
                <div style="margin-top: 2rem; padding-top: 2rem; border-top: 2px solid var(--border);">
                    <h3 style="margin-bottom: 1rem; font-size: 1.125rem; font-weight: 600;">답변 작성</h3>
                    <form id="inquiry-answer-form">
                        <div style="margin-bottom: 1rem;">
                            <textarea id="inquiry-answer-content" name="content" class="form-input" rows="5" placeholder="답변을 입력하세요" required style="resize: vertical; width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 0.375rem; font-family: inherit;"></textarea>
                        </div>
                        <div style="display: flex; justify-content: flex-end; gap: 0.5rem;">
                            <button type="submit" class="btn btn-primary">답변 작성</button>
                        </div>
                    </form>
                </div>
            `;

            const detailHtml = `
                <div class="detail-row">
                    <div class="detail-label">작성일시</div>
                    <div>${dateStr}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">제목</div>
                    <div>${inquiry.title}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">작성자</div>
                    <div>${inquiry.author || '-'}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">이메일</div>
                    <div>${inquiry.authorEmail || '-'}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">내용</div>
                    <div style="white-space: pre-line; line-height: 1.8;">${inquiry.content}</div>
                </div>
                ${answersHtml}
                ${answerFormHtml}
            `;

            $('#detail-content').html(detailHtml);
            $('#detail-modal').css('display', 'flex');
            
            // 승인/거절 버튼 숨기기 (문의는 승인/거절이 없음)
            $('#approve-btn, #reject-btn').hide();

            // 답변 작성 폼 이벤트 핸들러
            $('#inquiry-answer-form').off('submit').on('submit', function(e) {
                e.preventDefault();
                const answerContent = $('#inquiry-answer-content').val().trim();
                if (!answerContent) {
                    alert('답변 내용을 입력해주세요.');
                    return;
                }
                saveInquiryAnswer(id, answerContent);
            });
        }

        // 문의 답변 저장 함수
        function saveInquiryAnswer(inquiryId, answerContent) {
            try {
                const inquiryIndex = inquiries.findIndex(i => i.id === inquiryId);
                if (inquiryIndex === -1) {
                    alert('문의를 찾을 수 없습니다.');
                    return;
                }

                const inquiry = inquiries[inquiryIndex];
                
                // 답변 객체 생성
                const answer = {
                    id: Date.now().toString(),
                    content: answerContent,
                    author: '관리자',
                    authorEmail: 'admin@irumcompany.co.kr',
                    createdAt: new Date().toISOString()
                };

                // 답변 배열 초기화 (없는 경우)
                if (!inquiry.answers) {
                    inquiry.answers = [];
                }
                
                // 답변 추가
                inquiry.answers.push(answer);
                
                // localStorage 업데이트
                const stored = localStorage.getItem('inquiries');
                if (stored) {
                    let inquiryList = JSON.parse(stored);
                    const storedIndex = inquiryList.findIndex(i => String(i.id) === String(inquiryId));
                    if (storedIndex !== -1) {
                        inquiryList[storedIndex] = inquiry;
                        localStorage.setItem('inquiries', JSON.stringify(inquiryList));
                    }
                }

                // 로컬 배열 업데이트
                inquiries[inquiryIndex] = inquiry;

                // 통계 업데이트
                updateInquiryStatistics();

                // 목록 다시 렌더링
                filterInquiries();

                // 상세보기 다시 표시
                showInquiryDetail(inquiryId);

                alert('답변이 작성되었습니다.');
            } catch (e) {
                console.error('Error saving inquiry answer:', e);
                alert('답변 저장 중 오류가 발생했습니다.');
            }
        }

        // 공지사항 관련 함수들
        function loadNotices() {
            try {
                const stored = localStorage.getItem('communityNotices');
                if (stored) {
                    const parsed = JSON.parse(stored);
                    notices = Array.isArray(parsed) ? parsed.filter(n => {
                        return n && n.id && n.title && n.content && n.createdAt;
                    }) : [];
                    notices.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                } else {
                    notices = [];
                }
                updateNoticeStatistics();
                filterNotices();
            } catch (e) {
                console.error('Error loading notices:', e);
                notices = [];
                updateNoticeStatistics();
                filterNotices();
            }
        }

        function updateNoticeStatistics() {
            const total = notices.length;
            const published = notices.filter(n => n.status === 'published').length;
            const draft = notices.filter(n => n.status === 'draft').length;

            $('#total-notices').text(total);
            $('#published-notices').text(published);
            $('#draft-notices').text(draft);
        }

        function filterNotices() {
            const searchTerm = $('#notice-search-input').val().toLowerCase();
            let filtered = notices;

            if (searchTerm) {
                filtered = filtered.filter(n => 
                    (n.title && n.title.toLowerCase().includes(searchTerm)) ||
                    (n.content && n.content.toLowerCase().includes(searchTerm))
                );
            }

            renderNotices(filtered);
        }

        function renderNotices(noticeList) {
            const tbody = $('#notices-tbody');
            tbody.empty();

            if (noticeList.length === 0) {
                tbody.html('<tr><td colspan="6" class="no-applications">공지사항이 없습니다.</td></tr>');
                return;
            }

            noticeList.forEach(notice => {
                const date = new Date(notice.createdAt);
                const dateStr = date.toLocaleDateString('ko-KR') + ' ' + 
                               date.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
                
                const statusClass = notice.status === 'published' ? 'status-approved' : 'status-pending';
                const statusText = notice.status === 'published' ? '게시 중' : '임시저장';
                const views = notice.views || 0;

                const row = $(`
                    <tr>
                        <td>${dateStr}</td>
                        <td>${notice.title}</td>
                        <td>${notice.author || '관리자'}</td>
                        <td>${views}</td>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                        <td>
                            <button class="btn btn-sm btn-outline edit-notice" data-id="${notice.id}" style="margin-right: 0.5rem;">수정</button>
                            <button class="btn btn-sm" style="background: #ef4444; color: white; border: none;" data-id="${notice.id}" data-action="delete-notice">삭제</button>
                        </td>
                    </tr>
                `);

                row.find('.edit-notice').on('click', function() {
                    const id = $(this).data('id');
                    editNotice(id);
                });

                row.find('[data-action="delete-notice"]').on('click', function() {
                    const id = $(this).data('id');
                    if (confirm('정말로 이 공지사항을 삭제하시겠습니까?')) {
                        deleteNotice(id);
                    }
                });

                tbody.append(row);
            });
        }

        function saveNotice(isPublished) {
            const title = $('#notice-title').val().trim();
            const content = $('#notice-content').val().trim();
            const tagsInput = $('#notice-tags').val().trim();
            const tags = tagsInput ? tagsInput.split(',').map(t => t.trim()).filter(t => t) : [];

            if (!title || !content) {
                alert('제목과 내용을 입력해주세요.');
                return;
            }

            const noticeData = {
                id: currentNoticeId || Date.now().toString(),
                title: title,
                content: content,
                tags: tags,
                status: isPublished ? 'published' : 'draft',
                author: '관리자',
                authorRole: '운영팀',
                views: 0,
                likes: 0,
                comments: 0,
                createdAt: currentNoticeId ? notices.find(n => n.id === currentNoticeId)?.createdAt || new Date().toISOString() : new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };

            if (currentNoticeId) {
                // 수정
                const index = notices.findIndex(n => n.id === currentNoticeId);
                if (index !== -1) {
                    notices[index] = noticeData;
                }
            } else {
                // 새로 작성
                notices.push(noticeData);
            }

            try {
                localStorage.setItem('communityNotices', JSON.stringify(notices));
                $('#notice-modal').css('display', 'none');
                currentNoticeId = null;
                loadNotices();
                alert(isPublished ? '공지사항이 게시되었습니다.' : '공지사항이 임시저장되었습니다.');
            } catch (e) {
                console.error('Error saving notice:', e);
                alert('저장 중 오류가 발생했습니다.');
            }
        }

        function editNotice(id) {
            const notice = notices.find(n => n.id === id);
            if (!notice) return;

            currentNoticeId = id;
            $('#notice-modal-title').text('공지사항 수정');
            $('#notice-title').val(notice.title);
            $('#notice-content').val(notice.content);
            $('#notice-tags').val(notice.tags ? notice.tags.join(', ') : '');
            $('#notice-published').prop('checked', notice.status === 'published');
            $('#notice-modal').css('display', 'flex');
        }

        function deleteNotice(id) {
            try {
                // localStorage에서 직접 읽어와서 삭제
                const stored = localStorage.getItem('communityNotices');
                if (!stored) {
                    alert('공지사항 목록을 찾을 수 없습니다.');
                    return;
                }
                
                let noticeList = JSON.parse(stored);
                const noticeIndex = noticeList.findIndex(n => n && n.id === id);
                
                if (noticeIndex === -1) {
                    alert('공지사항을 찾을 수 없습니다.');
                    return;
                }

                // 배열에서 삭제
                noticeList.splice(noticeIndex, 1);
                
                // localStorage에 저장
                localStorage.setItem('communityNotices', JSON.stringify(noticeList));
                
                // 전역 배열 업데이트
                notices = noticeList;
                
                // 통계 업데이트
                updateNoticeStatistics();
                
                // 화면 즉시 갱신 - 필터 조건 적용하여 렌더링
                const searchTerm = $('#notice-search-input').val().toLowerCase();
                let filtered = notices;
                if (searchTerm) {
                    filtered = filtered.filter(n => 
                        (n.title && n.title.toLowerCase().includes(searchTerm)) ||
                        (n.content && n.content.toLowerCase().includes(searchTerm))
                    );
                }
                
                // 화면 강제 갱신
                renderNotices(filtered);
                
                alert('공지사항이 삭제되었습니다.');
            } catch (e) {
                console.error('Error deleting notice:', e);
                alert('삭제 중 오류가 발생했습니다.');
            }
        }

        // Courses Management Functions
        function loadCourses() {
            try {
                // Load courses from courses-data.js
                const coursesData = typeof COURSES_DATA !== 'undefined' ? COURSES_DATA : [];
                
                // Load prices from localStorage
                const storedPrices = localStorage.getItem('coursePrices');
                const prices = storedPrices ? JSON.parse(storedPrices) : {};
                
                // Merge courses with prices
                courses = coursesData.map(course => ({
                    ...course,
                    price: prices[course.slug] || 0
                }));
                
                renderCourses();
            } catch (e) {
                console.error('Error loading courses:', e);
                courses = [];
                renderCourses();
            }
        }

        function renderCourses() {
            const tbody = $('#courses-tbody');
            tbody.empty();

            // 필터 옵션 확인
            const filterOption = $('input[name="course-price-filter"]:checked').val();
            let filteredCourses = courses;

            if (filterOption === 'priced') {
                // 가격이 설정된 과정만 표시 (가격이 0보다 큰 경우)
                filteredCourses = courses.filter(c => c.price && c.price > 0);
            }

            if (filteredCourses.length === 0) {
                tbody.html('<tr><td colspan="4" class="no-applications">과정이 없습니다.</td></tr>');
                return;
            }

            filteredCourses.forEach(course => {
                const priceValue = course.price || 0;
                const row = $(`
                    <tr>
                        <td>${course.title}</td>
                        <td>${course.category}</td>
                        <td>
                            <input type="number" 
                                   class="form-input course-price-input" 
                                   style="width: 150px; padding: 0.5rem;" 
                                   value="${priceValue}" 
                                   data-slug="${course.slug}">
                            <span style="margin-left: 0.5rem;">원</span>
                        </td>
                        <td>
                            <button class="btn btn-sm btn-primary save-course-price-btn" data-slug="${course.slug}" style="margin-right: 0.5rem;">수정</button>
                            ${priceValue > 0 ? `<button class="btn btn-sm" style="background: #ef4444; color: white; border: none;" onclick="deleteCoursePrice('${course.slug}')">삭제</button>` : ''}
                        </td>
                    </tr>
                `);
                tbody.append(row);
            });

            // 저장 버튼 이벤트 핸들러
            $('.save-course-price-btn').off('click').on('click', function() {
                const slug = $(this).data('slug');
                const input = $(`.course-price-input[data-slug="${slug}"]`);
                const price = parseInt(input.val()) || 0;
                saveCoursePrice(slug, price);
            });
        }

        function updateCoursePrice(slug, price) {
            const course = courses.find(c => c.slug === slug);
            if (course) {
                course.price = parseInt(price) || 0;
            }
        }

        function saveCoursePrice(slug, price) {
            try {
                if (price === undefined) {
                    // 기존 방식 호환성 유지
                    const course = courses.find(c => c.slug === slug);
                    if (!course) {
                        alert('과정을 찾을 수 없습니다.');
                        return;
                    }
                    price = course.price || 0;
                } else {
                    // 가격이 파라미터로 전달된 경우
                    const course = courses.find(c => c.slug === slug);
                    if (course) {
                        course.price = parseInt(price) || 0;
                    }
                }

                const storedPrices = localStorage.getItem('coursePrices');
                const prices = storedPrices ? JSON.parse(storedPrices) : {};
                prices[slug] = parseInt(price) || 0;
                localStorage.setItem('coursePrices', JSON.stringify(prices));
                
                // 과정 목록 업데이트
                const courseIndex = courses.findIndex(c => c.slug === slug);
                if (courseIndex !== -1) {
                    courses[courseIndex].price = parseInt(price) || 0;
                }
                
                // 목록 다시 렌더링
                renderCourses();
                
                alert('가격이 저장되었습니다.');
            } catch (e) {
                console.error('Error saving course price:', e);
                alert('가격 저장 중 오류가 발생했습니다.');
            }
        }

        function deleteCoursePrice(slug) {
            if (!confirm('이 과정의 가격 정보를 삭제하시겠습니까?')) {
                return;
            }

            try {
                const storedPrices = localStorage.getItem('coursePrices');
                const prices = storedPrices ? JSON.parse(storedPrices) : {};
                delete prices[slug];
                localStorage.setItem('coursePrices', JSON.stringify(prices));
                
                // 과정 목록 업데이트
                const courseIndex = courses.findIndex(c => c.slug === slug);
                if (courseIndex !== -1) {
                    courses[courseIndex].price = 0;
                }
                
                // 목록 다시 렌더링
                renderCourses();
                
                alert('가격 정보가 삭제되었습니다.');
            } catch (e) {
                console.error('Error deleting course price:', e);
                alert('가격 삭제 중 오류가 발생했습니다.');
            }
        }

        function addCoursePrice() {
            // 과정 선택 드롭다운 채우기
            const select = $('#course-price-select');
            select.empty();
            select.append('<option value="">과정을 선택하세요</option>');
            
            // COURSES_DATA에서 과정 목록 가져오기
            const coursesData = typeof COURSES_DATA !== 'undefined' ? COURSES_DATA : [];
            coursesData.forEach(course => {
                select.append(`<option value="${course.slug}">${course.title} (${course.category})</option>`);
            });
            
            // 모달 초기화
            $('#course-price-modal-title').text('과정 가격 설정');
            $('#course-price-amount').val('');
            $('#course-price-modal').css('display', 'flex');
        }

        function saveCoursePriceFromModal() {
            try {
                const slug = $('#course-price-select').val();
                const price = parseInt($('#course-price-amount').val()) || 0;

                if (!slug) {
                    alert('과정을 선택해주세요.');
                    return;
                }

                if (price <= 0) {
                    alert('가격을 올바르게 입력해주세요.');
                    return;
                }

                // 가격 저장
                saveCoursePrice(slug, price);
                
                // 모달 닫기
                $('#course-price-modal').hide();
            } catch (e) {
                console.error('Error saving course price from modal:', e);
                alert('가격 저장 중 오류가 발생했습니다.');
            }
        }

        // Schedules Management Functions (온라인강의 일정만 관리)
        function loadSchedules() {
            try {
                const stored = localStorage.getItem('courseSchedules');
                if (stored) {
                    schedules = JSON.parse(stored);
                } else {
                    schedules = [];
                }
                renderSchedules();
            } catch (e) {
                console.error('Error loading schedules:', e);
                schedules = [];
                renderSchedules();
            }
        }

        function renderSchedules() {
            const tbody = $('#schedules-tbody');
            tbody.empty();

            if (schedules.length === 0) {
                tbody.html('<tr><td colspan="4" class="no-applications">일정이 없습니다.</td></tr>');
                return;
            }

            // COURSES_DATA에서 과정 목록 가져오기
            const coursesData = typeof COURSES_DATA !== 'undefined' ? COURSES_DATA : [];

            schedules.forEach(schedule => {
                const date = new Date(schedule.date);
                const dateStr = date.toLocaleDateString('ko-KR');
                const statusClass = schedule.active ? 'status-approved' : 'status-pending';
                const statusText = schedule.active ? '활성' : '비활성';
                
                // 강의코스 정보 가져오기
                let courseName = schedule.courseName || '미지정';
                if (schedule.courseSlug) {
                    const course = coursesData.find(c => c.slug === schedule.courseSlug);
                    if (course) {
                        courseName = course.title;
                    }
                }

                const row = $(`
                    <tr>
                        <td>${dateStr}</td>
                        <td>${courseName}</td>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                        <td>
                            <button class="btn btn-sm btn-outline" onclick="editSchedule('${schedule.id}')" style="margin-right: 0.5rem;">수정</button>
                            <button class="btn btn-sm" style="background: #ef4444; color: white; border: none;" onclick="deleteSchedule('${schedule.id}')">삭제</button>
                        </td>
                    </tr>
                `);
                tbody.append(row);
            });
        }

        function addSchedule() {
            currentScheduleId = null;
            $('#schedule-modal-title').text('일정 추가');
            $('#schedule-date').val('');
            $('#schedule-active').prop('checked', true);
            
            // 강의코스 선택 옵션 로드
            const courseSelect = $('#schedule-course');
            courseSelect.empty();
            courseSelect.append('<option value="">강의코스 선택</option>');
            
            const coursesData = typeof COURSES_DATA !== 'undefined' ? COURSES_DATA : [];
            coursesData.forEach(course => {
                courseSelect.append(`<option value="${course.slug}">${course.title}</option>`);
            });
            
            $('#schedule-modal').css('display', 'flex');
        }

        function editSchedule(id) {
            const schedule = schedules.find(s => s.id === id);
            if (!schedule) {
                alert('일정을 찾을 수 없습니다.');
                return;
            }

            currentScheduleId = id;
            $('#schedule-modal-title').text('일정 수정');
            $('#schedule-date').val(schedule.date);
            $('#schedule-active').prop('checked', schedule.active !== false);
            
            // 강의코스 선택 옵션 로드
            const courseSelect = $('#schedule-course');
            courseSelect.empty();
            courseSelect.append('<option value="">강의코스 선택</option>');
            
            const coursesData = typeof COURSES_DATA !== 'undefined' ? COURSES_DATA : [];
            coursesData.forEach(course => {
                const selected = schedule.courseSlug === course.slug ? 'selected' : '';
                courseSelect.append(`<option value="${course.slug}" ${selected}>${course.title}</option>`);
            });
            
            $('#schedule-modal').css('display', 'flex');
        }

        function deleteSchedule(id) {
            if (!confirm('정말로 이 일정을 삭제하시겠습니까?')) {
                return;
            }

            try {
                const index = schedules.findIndex(s => s.id === id);
                if (index === -1) {
                    alert('일정을 찾을 수 없습니다.');
                    return;
                }

                schedules.splice(index, 1);
                localStorage.setItem('courseSchedules', JSON.stringify(schedules));
                renderSchedules();
                alert('일정이 삭제되었습니다.');
            } catch (e) {
                console.error('Error deleting schedule:', e);
                alert('삭제 중 오류가 발생했습니다.');
            }
        }

        function saveSchedule() {
            try {
                const date = $('#schedule-date').val();
                const courseSlug = $('#schedule-course').val();
                const active = $('#schedule-active').is(':checked');

                if (!date) {
                    alert('일정을 입력해주세요.');
                    return;
                }

                if (!courseSlug) {
                    alert('강의코스를 선택해주세요.');
                    return;
                }

                // 강의코스 정보 가져오기
                const coursesData = typeof COURSES_DATA !== 'undefined' ? COURSES_DATA : [];
                const selectedCourse = coursesData.find(c => c.slug === courseSlug);
                const courseName = selectedCourse ? selectedCourse.title : '';

                if (currentScheduleId) {
                    // 기존 일정 수정
                    const index = schedules.findIndex(s => s.id === currentScheduleId);
                    if (index !== -1) {
                        schedules[index].date = date;
                        schedules[index].courseSlug = courseSlug;
                        schedules[index].courseName = courseName;
                        schedules[index].active = active;
                    }
                } else {
                    // 새 일정 추가
                    const newSchedule = {
                        id: Date.now().toString(),
                        date: date,
                        courseSlug: courseSlug,
                        courseName: courseName,
                        active: active,
                        createdAt: new Date().toISOString()
                    };
                    schedules.push(newSchedule);
                }

                localStorage.setItem('courseSchedules', JSON.stringify(schedules));
                renderSchedules();
                $('#schedule-modal').hide();
                alert('일정이 저장되었습니다.');
            } catch (e) {
                console.error('Error saving schedule:', e);
                alert('일정 저장 중 오류가 발생했습니다.');
            }
        }

        // Instructor Program Management Functions
        function loadInstructorProgram() {
            try {
                // Load programs list
                const storedPrograms = localStorage.getItem('instructorPrograms');
                if (storedPrograms) {
                    instructorPrograms = JSON.parse(storedPrograms);
                } else {
                    instructorPrograms = [];
                }
                
                // 가장 최신 프로그램을 instructorProgram(단수)로도 저장 (하위 호환성)
                if (instructorPrograms.length > 0) {
                    const latestProgram = instructorPrograms[instructorPrograms.length - 1];
                    localStorage.setItem('instructorProgram', JSON.stringify(latestProgram));
                }
                
                renderInstructorPrograms();

                // Load schedules
                const storedSchedules = localStorage.getItem('instructorSchedules');
                if (storedSchedules) {
                    instructorSchedules = JSON.parse(storedSchedules);
                } else {
                    instructorSchedules = [];
                }

                // Load consult schedules
                const storedConsultSchedules = localStorage.getItem('consultSchedules');
                if (storedConsultSchedules) {
                    consultSchedules = JSON.parse(storedConsultSchedules);
                } else {
                    consultSchedules = [];
                }

                renderInstructorSchedules();
                renderConsultSchedules();
            } catch (e) {
                console.error('Error loading instructor program:', e);
                instructorPrograms = [];
                instructorSchedules = [];
                consultSchedules = [];
                renderInstructorPrograms();
                renderInstructorSchedules();
                renderConsultSchedules();
            }
        }
        
        function renderInstructorPrograms() {
            const tbody = $('#instructor-programs-tbody');
            tbody.empty();
            
            if (instructorPrograms.length === 0) {
                tbody.html('<tr><td colspan="3" class="no-applications">등록된 프로그램이 없습니다.</td></tr>');
                return;
            }
            
            instructorPrograms.forEach((program, index) => {
                const row = $(`
                    <tr>
                        <td>${program.title}</td>
                        <td style="max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${program.description}</td>
                        <td>
                            <button class="btn btn-sm" style="background: #ef4444; color: white; border: none;" onclick="deleteInstructorProgram(${index})">삭제</button>
                        </td>
                    </tr>
                `);
                tbody.append(row);
            });
        }
        
        function deleteInstructorProgram(index) {
            if (!confirm('정말로 이 프로그램을 삭제하시겠습니까?')) {
                return;
            }
            
            try {
                instructorPrograms.splice(index, 1);
                localStorage.setItem('instructorPrograms', JSON.stringify(instructorPrograms));
                
                // 가장 최신 프로그램을 instructorProgram(단수)로도 업데이트
                if (instructorPrograms.length > 0) {
                    const latestProgram = instructorPrograms[instructorPrograms.length - 1];
                    localStorage.setItem('instructorProgram', JSON.stringify(latestProgram));
                } else {
                    localStorage.removeItem('instructorProgram');
                }
                
                renderInstructorPrograms();
                alert('프로그램이 삭제되었습니다.');
            } catch (e) {
                console.error('Error deleting program:', e);
                alert('삭제 중 오류가 발생했습니다.');
            }
        }

        function saveProgramInfo() {
            try {
                const title = $('#instructor-program-title').val();
                const description = $('#instructor-program-description').val();
                
                if (!title || !description) {
                    alert('프로그램명과 프로그램 설명을 모두 입력해주세요.');
                    return;
                }
                
                const newProgram = {
                    id: Date.now().toString(),
                    title: title,
                    description: description,
                    createdAt: new Date().toISOString()
                };
                
                instructorPrograms.push(newProgram);
                localStorage.setItem('instructorPrograms', JSON.stringify(instructorPrograms));
                
                // 가장 최신 프로그램을 instructorProgram(단수)로도 저장 (하위 호환성)
                localStorage.setItem('instructorProgram', JSON.stringify(newProgram));
                
                // 입력 필드 초기화
                $('#instructor-program-title').val('');
                $('#instructor-program-description').val('');
                
                renderInstructorPrograms();
                alert('프로그램이 추가되었습니다.');
            } catch (e) {
                console.error('Error saving program info:', e);
                alert('프로그램 정보 저장 중 오류가 발생했습니다.');
            }
        }

        function renderInstructorSchedules() {
            const tbody = $('#instructor-schedules-tbody');
            tbody.empty();

            if (instructorSchedules.length === 0) {
                tbody.html('<tr><td colspan="4" class="no-applications">일정이 없습니다.</td></tr>');
                return;
            }

            instructorSchedules.forEach(schedule => {
                const date = new Date(schedule.date);
                const dateStr = date.toLocaleDateString('ko-KR');
                const statusClass = schedule.active ? 'status-approved' : 'status-pending';
                const statusText = schedule.active ? '활성' : '비활성';
                
                // 프로그램 정보 가져오기
                let programName = schedule.programName || '미지정';
                if (schedule.programId) {
                    const program = instructorPrograms.find(p => p.id === schedule.programId);
                    if (program) {
                        programName = program.title;
                    }
                }

                const row = $(`
                    <tr>
                        <td>${programName}</td>
                        <td>${dateStr}</td>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                        <td>
                            <button class="btn btn-sm btn-outline" onclick="editInstructorSchedule('${schedule.id}')" style="margin-right: 0.5rem;">수정</button>
                            <button class="btn btn-sm" style="background: #ef4444; color: white; border: none;" onclick="deleteInstructorSchedule('${schedule.id}')">삭제</button>
                        </td>
                    </tr>
                `);
                tbody.append(row);
            });
        }

        function renderConsultSchedules() {
            const tbody = $('#consult-schedules-tbody');
            tbody.empty();

            if (consultSchedules.length === 0) {
                tbody.html('<tr><td colspan="5" class="no-applications">상담 일정이 없습니다.</td></tr>');
                return;
            }

            const coursesData = typeof COURSES_DATA !== 'undefined' ? COURSES_DATA : [];

            consultSchedules.forEach(schedule => {
                const date = new Date(schedule.date);
                const dateStr = date.toLocaleDateString('ko-KR');
                const statusClass = schedule.active ? 'status-approved' : 'status-pending';
                const statusText = schedule.active ? '활성' : '비활성';
                
                // 강의코스 정보 가져오기
                let courseName = schedule.courseName || '미지정';
                if (schedule.courseSlug) {
                    const course = coursesData.find(c => c.slug === schedule.courseSlug);
                    if (course) {
                        courseName = course.title;
                    }
                }

                const row = $(`
                    <tr>
                        <td>${courseName}</td>
                        <td>${dateStr}</td>
                        <td>${schedule.time || '-'}</td>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                        <td>
                            <button class="btn btn-sm btn-outline" onclick="editConsultSchedule('${schedule.id}')" style="margin-right: 0.5rem;">수정</button>
                            <button class="btn btn-sm" style="background: #ef4444; color: white; border: none;" onclick="deleteConsultSchedule('${schedule.id}')">삭제</button>
                        </td>
                    </tr>
                `);
                tbody.append(row);
            });
        }

        function addInstructorSchedule() {
            currentInstructorScheduleId = null;
            $('#instructor-schedule-modal-title').text('프로그램 일정 추가');
            
            // 프로그램 선택 옵션 로드
            const programSelect = $('#instructor-schedule-program');
            programSelect.empty();
            programSelect.append('<option value="">프로그램을 선택하세요</option>');
            
            instructorPrograms.forEach(program => {
                programSelect.append(`<option value="${program.id}">${program.title}</option>`);
            });
            
            if (instructorPrograms.length === 0) {
                alert('먼저 프로그램을 등록해주세요.');
                return;
            }
            
            $('#instructor-schedule-dates-container').html(`
                <div class="schedule-date-item" style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem; align-items: center;">
                    <input type="date" class="form-input instructor-schedule-date-input" required style="flex: 1;">
                    <button type="button" class="btn btn-sm" style="background: #ef4444; color: white; border: none; display: none;" onclick="removeInstructorScheduleDate(this)">삭제</button>
                </div>
            `);
            $('#instructor-schedule-active').prop('checked', true);
            $('#instructor-schedule-modal').css('display', 'flex');
        }

        function addInstructorScheduleDate() {
            const container = $('#instructor-schedule-dates-container');
            const newItem = $(`
                <div class="schedule-date-item" style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem; align-items: center;">
                    <input type="date" class="form-input instructor-schedule-date-input" required style="flex: 1;">
                    <button type="button" class="btn btn-sm" style="background: #ef4444; color: white; border: none;" onclick="removeInstructorScheduleDate(this)">삭제</button>
                </div>
            `);
            container.append(newItem);
            // 첫 번째 항목의 삭제 버튼도 표시
            container.find('.schedule-date-item').first().find('button').show();
        }

        function removeInstructorScheduleDate(btn) {
            const container = $('#instructor-schedule-dates-container');
            if (container.find('.schedule-date-item').length > 1) {
                $(btn).closest('.schedule-date-item').remove();
            }
        }

        function editInstructorSchedule(id) {
            const schedule = instructorSchedules.find(s => s.id === id);
            if (!schedule) {
                alert('일정을 찾을 수 없습니다.');
                return;
            }

            currentInstructorScheduleId = id;
            $('#instructor-schedule-modal-title').text('프로그램 일정 수정');
            
            // 프로그램 선택 옵션 로드
            const programSelect = $('#instructor-schedule-program');
            programSelect.empty();
            programSelect.append('<option value="">프로그램을 선택하세요</option>');
            
            instructorPrograms.forEach(program => {
                const selected = schedule.programId === program.id ? 'selected' : '';
                programSelect.append(`<option value="${program.id}" ${selected}>${program.title}</option>`);
            });
            
            // 수정 시에는 단일 일정만 표시
            $('#instructor-schedule-dates-container').html(`
                <div class="schedule-date-item" style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem; align-items: center;">
                    <input type="date" class="form-input instructor-schedule-date-input" required style="flex: 1;" value="${schedule.date}">
                    <button type="button" class="btn btn-sm" style="background: #ef4444; color: white; border: none; display: none;" onclick="removeInstructorScheduleDate(this)">삭제</button>
                </div>
            `);
            $('#instructor-schedule-active').prop('checked', schedule.active !== false);
            $('#instructor-schedule-modal').css('display', 'flex');
        }

        function deleteInstructorSchedule(id) {
            if (!confirm('정말로 이 일정을 삭제하시겠습니까?')) {
                return;
            }

            try {
                const index = instructorSchedules.findIndex(s => s.id === id);
                if (index === -1) {
                    alert('일정을 찾을 수 없습니다.');
                    return;
                }

                instructorSchedules.splice(index, 1);
                localStorage.setItem('instructorSchedules', JSON.stringify(instructorSchedules));
                renderInstructorSchedules();
                alert('일정이 삭제되었습니다.');
            } catch (e) {
                console.error('Error deleting instructor schedule:', e);
                alert('삭제 중 오류가 발생했습니다.');
            }
        }

        function saveInstructorSchedule() {
            try {
                const programId = $('#instructor-schedule-program').val();
                if (!programId) {
                    alert('프로그램을 선택해주세요.');
                    return;
                }
                
                const selectedProgram = instructorPrograms.find(p => p.id === programId);
                if (!selectedProgram) {
                    alert('선택한 프로그램을 찾을 수 없습니다.');
                    return;
                }
                
                const dates = [];
                $('.instructor-schedule-date-input').each(function() {
                    const date = $(this).val();
                    if (date) {
                        dates.push(date);
                    }
                });

                if (dates.length === 0) {
                    alert('최소 하나의 일정을 입력해주세요.');
                    return;
                }

                const active = $('#instructor-schedule-active').is(':checked');

                if (currentInstructorScheduleId) {
                    // 기존 일정 수정 (단일 일정)
                    const schedule = instructorSchedules.find(s => s.id === currentInstructorScheduleId);
                    if (schedule && dates.length > 0) {
                        schedule.date = dates[0];
                        schedule.programId = programId;
                        schedule.programName = selectedProgram.title;
                        schedule.active = active;
                    }
                } else {
                    // 새 일정 추가 (복수 일정 가능)
                    dates.forEach((date, index) => {
                        const newSchedule = {
                            id: (Date.now() + index).toString(),
                            programId: programId,
                            programName: selectedProgram.title,
                            date: date,
                            active: active,
                            createdAt: new Date().toISOString()
                        };
                        instructorSchedules.push(newSchedule);
                    });
                }

                localStorage.setItem('instructorSchedules', JSON.stringify(instructorSchedules));
                renderInstructorSchedules();
                $('#instructor-schedule-modal').hide();
                alert(`${dates.length}개의 일정이 저장되었습니다.`);
            } catch (e) {
                console.error('Error saving instructor schedule:', e);
                alert('일정 저장 중 오류가 발생했습니다.');
            }
        }

        function addConsultSchedule() {
            currentConsultScheduleId = null;
            $('#consult-schedule-modal-title').text('상담 일정 추가');
            
            // 강의코스 선택 옵션 로드
            const courseSelect = $('#consult-schedule-course');
            courseSelect.empty();
            courseSelect.append('<option value="">과정을 선택하세요</option>');
            
            const coursesData = typeof COURSES_DATA !== 'undefined' ? COURSES_DATA : [];
            coursesData.forEach(course => {
                courseSelect.append(`<option value="${course.slug}">${course.title}</option>`);
            });
            
            $('#consult-schedule-items-container').html(`
                <div class="consult-schedule-item" style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem; align-items: center;">
                    <input type="date" class="form-input consult-schedule-date-input" required style="flex: 1;">
                    <select class="form-input consult-schedule-time-input" required style="width: 120px;">
                        <option value="">시간 선택</option>
                        <option value="09:00">09:00</option>
                        <option value="10:00">10:00</option>
                        <option value="11:00">11:00</option>
                        <option value="12:00">12:00</option>
                        <option value="13:00">13:00</option>
                        <option value="14:00">14:00</option>
                        <option value="15:00">15:00</option>
                        <option value="16:00">16:00</option>
                        <option value="17:00">17:00</option>
                        <option value="18:00">18:00</option>
                        <option value="19:00">19:00</option>
                        <option value="20:00">20:00</option>
                    </select>
                    <button type="button" class="btn btn-sm" style="background: #ef4444; color: white; border: none; display: none;" onclick="removeConsultScheduleItem(this)">삭제</button>
                </div>
            `);
            $('#consult-schedule-active').prop('checked', true);
            $('#consult-schedule-modal').css('display', 'flex');
        }

        function addConsultScheduleItem() {
            const container = $('#consult-schedule-items-container');
            const newItem = $(`
                <div class="consult-schedule-item" style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem; align-items: center;">
                    <input type="date" class="form-input consult-schedule-date-input" required style="flex: 1;">
                    <select class="form-input consult-schedule-time-input" required style="width: 120px;">
                        <option value="">시간 선택</option>
                        <option value="09:00">09:00</option>
                        <option value="10:00">10:00</option>
                        <option value="11:00">11:00</option>
                        <option value="12:00">12:00</option>
                        <option value="13:00">13:00</option>
                        <option value="14:00">14:00</option>
                        <option value="15:00">15:00</option>
                        <option value="16:00">16:00</option>
                        <option value="17:00">17:00</option>
                        <option value="18:00">18:00</option>
                        <option value="19:00">19:00</option>
                        <option value="20:00">20:00</option>
                    </select>
                    <button type="button" class="btn btn-sm" style="background: #ef4444; color: white; border: none;" onclick="removeConsultScheduleItem(this)">삭제</button>
                </div>
            `);
            container.append(newItem);
            // 첫 번째 항목의 삭제 버튼도 표시
            container.find('.consult-schedule-item').first().find('button').show();
        }

        function removeConsultScheduleItem(btn) {
            const container = $('#consult-schedule-items-container');
            if (container.find('.consult-schedule-item').length > 1) {
                $(btn).closest('.consult-schedule-item').remove();
            }
        }

        function editConsultSchedule(id) {
            const schedule = consultSchedules.find(s => s.id === id);
            if (!schedule) {
                alert('일정을 찾을 수 없습니다.');
                return;
            }

            currentConsultScheduleId = id;
            $('#consult-schedule-modal-title').text('상담 일정 수정');
            
            // 강의코스 선택 옵션 로드
            const courseSelect = $('#consult-schedule-course');
            courseSelect.empty();
            courseSelect.append('<option value="">과정을 선택하세요</option>');
            
            const coursesData = typeof COURSES_DATA !== 'undefined' ? COURSES_DATA : [];
            coursesData.forEach(course => {
                const selected = schedule.courseSlug === course.slug ? 'selected' : '';
                courseSelect.append(`<option value="${course.slug}" ${selected}>${course.title}</option>`);
            });
            
            // 수정 시에는 단일 일정만 표시
            $('#consult-schedule-items-container').html(`
                <div class="consult-schedule-item" style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem; align-items: center;">
                    <input type="date" class="form-input consult-schedule-date-input" required style="flex: 1;" value="${schedule.date}">
                    <select class="form-input consult-schedule-time-input" required style="width: 120px;">
                        <option value="">시간 선택</option>
                        <option value="09:00" ${schedule.time === '09:00' ? 'selected' : ''}>09:00</option>
                        <option value="10:00" ${schedule.time === '10:00' ? 'selected' : ''}>10:00</option>
                        <option value="11:00" ${schedule.time === '11:00' ? 'selected' : ''}>11:00</option>
                        <option value="12:00" ${schedule.time === '12:00' ? 'selected' : ''}>12:00</option>
                        <option value="13:00" ${schedule.time === '13:00' ? 'selected' : ''}>13:00</option>
                        <option value="14:00" ${schedule.time === '14:00' ? 'selected' : ''}>14:00</option>
                        <option value="15:00" ${schedule.time === '15:00' ? 'selected' : ''}>15:00</option>
                        <option value="16:00" ${schedule.time === '16:00' ? 'selected' : ''}>16:00</option>
                        <option value="17:00" ${schedule.time === '17:00' ? 'selected' : ''}>17:00</option>
                        <option value="18:00" ${schedule.time === '18:00' ? 'selected' : ''}>18:00</option>
                        <option value="19:00" ${schedule.time === '19:00' ? 'selected' : ''}>19:00</option>
                        <option value="20:00" ${schedule.time === '20:00' ? 'selected' : ''}>20:00</option>
                    </select>
                    <button type="button" class="btn btn-sm" style="background: #ef4444; color: white; border: none; display: none;" onclick="removeConsultScheduleItem(this)">삭제</button>
                </div>
            `);
            $('#consult-schedule-active').prop('checked', schedule.active !== false);
            $('#consult-schedule-modal').css('display', 'flex');
        }

        function deleteConsultSchedule(id) {
            if (!confirm('정말로 이 일정을 삭제하시겠습니까?')) {
                return;
            }

            try {
                const index = consultSchedules.findIndex(s => s.id === id);
                if (index === -1) {
                    alert('일정을 찾을 수 없습니다.');
                    return;
                }

                consultSchedules.splice(index, 1);
                localStorage.setItem('consultSchedules', JSON.stringify(consultSchedules));
                renderConsultSchedules();
                alert('일정이 삭제되었습니다.');
            } catch (e) {
                console.error('Error deleting consult schedule:', e);
                alert('삭제 중 오류가 발생했습니다.');
            }
        }

        function saveConsultSchedule() {
            try {
                const courseSlug = $('#consult-schedule-course').val();
                if (!courseSlug) {
                    alert('과정을 선택해주세요.');
                    return;
                }
                
                const coursesData = typeof COURSES_DATA !== 'undefined' ? COURSES_DATA : [];
                const selectedCourse = coursesData.find(c => c.slug === courseSlug);
                const courseName = selectedCourse ? selectedCourse.title : '';
                
                const scheduleItems = [];
                $('.consult-schedule-item').each(function() {
                    const date = $(this).find('.consult-schedule-date-input').val();
                    const time = $(this).find('.consult-schedule-time-input').val();
                    if (date && time) {
                        scheduleItems.push({ date, time });
                    }
                });

                if (scheduleItems.length === 0) {
                    alert('최소 하나의 일정과 시간을 입력해주세요.');
                    return;
                }

                const active = $('#consult-schedule-active').is(':checked');

                if (currentConsultScheduleId) {
                    // 기존 일정 수정 (단일 일정)
                    const schedule = consultSchedules.find(s => s.id === currentConsultScheduleId);
                    if (schedule && scheduleItems.length > 0) {
                        schedule.date = scheduleItems[0].date;
                        schedule.time = scheduleItems[0].time;
                        schedule.courseSlug = courseSlug;
                        schedule.courseName = courseName;
                        schedule.active = active;
                    }
                } else {
                    // 새 일정 추가 (복수 일정 가능)
                    scheduleItems.forEach((item, index) => {
                        const newSchedule = {
                            id: (Date.now() + index).toString(),
                            courseSlug: courseSlug,
                            courseName: courseName,
                            date: item.date,
                            time: item.time,
                            active: active,
                            createdAt: new Date().toISOString()
                        };
                        consultSchedules.push(newSchedule);
                    });
                }

                localStorage.setItem('consultSchedules', JSON.stringify(consultSchedules));
                renderConsultSchedules();
                $('#consult-schedule-modal').hide();
                alert(`${scheduleItems.length}개의 일정이 저장되었습니다.`);
            } catch (e) {
                console.error('Error saving consult schedule:', e);
                alert('일정 저장 중 오류가 발생했습니다.');
            }
        }

        // Event handlers for modals
        $(document).ready(function() {
            // Schedule modal handlers
            $('#add-schedule-btn').on('click', addSchedule);
            $('#schedule-form').on('submit', function(e) {
                e.preventDefault();
                saveSchedule();
            });
            $('#cancel-schedule-btn, #close-schedule-modal, #schedule-modal-backdrop').on('click', function() {
                $('#schedule-modal').hide();
            });
            

            // Instructor schedule modal handlers
            $('#add-instructor-schedule-btn').on('click', addInstructorSchedule);
            $('#instructor-schedule-form').on('submit', function(e) {
                e.preventDefault();
                saveInstructorSchedule();
            });
            $('#cancel-instructor-schedule-btn, #close-instructor-schedule-modal, #instructor-schedule-modal-backdrop').on('click', function() {
                $('#instructor-schedule-modal').hide();
            });

            // Consult schedule modal handlers
            $('#add-consult-schedule-btn').on('click', addConsultSchedule);
            $('#consult-schedule-form').on('submit', function(e) {
                e.preventDefault();
                saveConsultSchedule();
            });
            $('#cancel-consult-schedule-btn, #close-consult-schedule-modal, #consult-schedule-modal-backdrop').on('click', function() {
                $('#consult-schedule-modal').hide();
            });

            // Course price modal handlers
            $('#add-course-price-btn').on('click', addCoursePrice);
            $('#course-price-form').on('submit', function(e) {
                e.preventDefault();
                saveCoursePriceFromModal();
            });
            $('#cancel-course-price-btn, #close-course-price-modal, #course-price-modal-backdrop').on('click', function() {
                $('#course-price-modal').hide();
            });

            // Course price filter handlers
            $('input[name="course-price-filter"]').on('change', function() {
                renderCourses();
            });

            // Program info save handler
            $('#save-program-info-btn').on('click', saveProgramInfo);
        });
    </script>
</body>
</html>


